!function(){function e(e,n,o){var t={restrict:"A",require:["?ngModel","?mailcheck"],scope:{},bindToController:{options:"="},controller:function(){},controllerAs:"MC",link:function(n,t,i,l){function a(e,n){var o;for(o in n)n.hasOwnProperty(o)&&e[o]&&e[o].length&&(e[o]=n[o].concat(e[o]));return e}var c,r=l[0],u=l[1],s=null,g=u.options.templateStr||'<p ng-show="MC.suggestion.domain">Did you mean <b ng-click="MC.correctMe(MC.suggestion.full)"><i ng-bind="MC.suggestion.full"></i></b>?</p>',m={templateStr:g,replaceOptions:!0},p=angular.extend({},m,u.options);p.replaceOptions||(c={domains:o.defaultDomains,secondLevelDomains:o.defaultSecondLevelDomains,topLevelDomains:o.defaultTopLevelDomains},p=angular.extend({},m,a(u.options,c))),u.suggestion=!1,t.after(e(p.templateStr)(n)),t.on("blur",function(){p.email=r.$viewValue,u.suggestion=!1,s=o.run(p),n.$evalAsync(function(){u.suggestion=s})}),u.correctMe=function(e){r.$setViewValue(e),r.$render(),n.$evalAsync(function(){u.suggestion.domain=null})}}};return t}e.$inject=["$compile","$timeout","mailcheckFactory"],angular.module("ngMailcheck",[]).directive("mailcheck",e)}();
!function(){function e(){var e={domainThreshold:2,secondLevelThreshold:2,topLevelThreshold:2,defaultDomains:["msn.com","bellsouth.net","telus.net","comcast.net","optusnet.com.au","earthlink.net","qq.com","sky.com","icloud.com","mac.com","sympatico.ca","googlemail.com","att.net","xtra.co.nz","web.de","cox.net","gmail.com","ymail.com","aim.com","rogers.com","verizon.net","rocketmail.com","google.com","optonline.net","sbcglobal.net","aol.com","me.com","btinternet.com","charter.net","shaw.ca"],defaultSecondLevelDomains:["yahoo","hotmail","mail","live","outlook","gmx"],defaultTopLevelDomains:["com","com.au","com.tw","ca","co.nz","co.uk","de","fr","it","ru","net","org","edu","gov","jp","nl","kr","se","eu","ie","co.il","us","at","be","dk","hk","es","gr","ch","no","cz","in","net","net.au","info","biz","mil","co.jp","sg","hu","uk"],run:function(n){n.domains=n.domains||e.defaultDomains,n.secondLevelDomains=n.secondLevelDomains||e.defaultSecondLevelDomains,n.topLevelDomains=n.topLevelDomains||e.defaultTopLevelDomains,n.distanceFunction=n.distanceFunction||e.sift4Distance;var o=function(e){return e},t=(n.suggested||o,n.empty||o,e.suggest(e.encodeEmail(n.email),n.domains,n.secondLevelDomains,n.topLevelDomains,n.distanceFunction));return t},suggest:function(e,n,o,t,a){e=e.toLowerCase();var i=this.splitEmail(e);if(o&&t&&o.indexOf(i.secondLevelDomain)!==-1&&t.indexOf(i.topLevelDomain)!==-1)return!1;var l=this.findClosestDomain(i.domain,n,a,this.domainThreshold);if(l)return l!=i.domain&&{address:i.address,domain:l,full:i.address+"@"+l};var r=this.findClosestDomain(i.secondLevelDomain,o,a,this.secondLevelThreshold),s=this.findClosestDomain(i.topLevelDomain,t,a,this.topLevelThreshold);if(i.domain){l=i.domain;var c=!1;if(r&&r!=i.secondLevelDomain&&(l=l.replace(i.secondLevelDomain,r),c=!0),s&&s!=i.topLevelDomain&&""!==i.secondLevelDomain&&(l=l.replace(new RegExp(i.topLevelDomain+"$"),s),c=!0),c)return{address:i.address,domain:l,full:i.address+"@"+l}}return!1},findClosestDomain:function(e,n,o,t){t=t||this.topLevelThreshold;var a,i=1/0,l=null;if(!e||!n)return!1;o||(o=this.sift4Distance);for(var r=0;r<n.length;r++){if(e===n[r])return e;a=o(e,n[r]),a<i&&(i=a,l=n[r])}return i<=t&&null!==l&&l},sift4Distance:function(e,n,o){if(void 0===o&&(o=5),!e||!e.length)return n?n.length:0;if(!n||!n.length)return e.length;for(var t=e.length,a=n.length,i=0,l=0,r=0,s=0,c=0,m=[];i<t&&l<a;){if(e.charAt(i)==n.charAt(l)){s++;for(var d=!1,u=0;u<m.length;){var h=m[u];if(i<=h.c1||l<=h.c2){d=Math.abs(l-i)>=Math.abs(h.c2-h.c1),d?c++:h.trans||(h.trans=!0,c++);break}i>h.c2&&l>h.c1?m.splice(u,1):u++}m.push({c1:i,c2:l,trans:d})}else{r+=s,s=0,i!=l&&(i=l=Math.min(i,l));for(var f=0;f<o&&(i+f<t||l+f<a);f++){if(i+f<t&&e.charAt(i+f)==n.charAt(l)){i+=f-1,l--;break}if(l+f<a&&e.charAt(i)==n.charAt(l+f)){i--,l+=f-1;break}}}i++,l++,(i>=t||l>=a)&&(r+=s,s=0,i=l=Math.min(i,l))}return r+=s,Math.round(Math.max(t,a)-r+c)},splitEmail:function(e){e=null!==e?e.replace(/^\s*/,"").replace(/\s*$/,""):null;var n=e.split("@");if(n.length<2)return!1;for(var o=0;o<n.length;o++)if(""===n[o])return!1;var t=n.pop(),a=t.split("."),i="",l="";if(0===a.length)return!1;if(1==a.length)l=a[0];else{i=a[0];for(var r=1;r<a.length;r++)l+=a[r]+".";l=l.substring(0,l.length-1)}return{topLevelDomain:l,secondLevelDomain:i,domain:t,address:n.join("@")}},encodeEmail:function(e){var n=encodeURI(e);return n=n.replace("%20"," ").replace("%25","%").replace("%5E","^").replace("%60","`").replace("%7B","{").replace("%7C","|").replace("%7D","}")}};return e}e.$inject=[],angular.module("ngMailcheck").factory("mailcheckFactory",e)}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haWxjaGVjay5kaXJlY3RpdmUuanMiLCJtYWlsY2hlY2suZmFjdG9yeS5qcyJdLCJuYW1lcyI6WyJtYWlsY2hlY2siLCIkY29tcGlsZSIsIiR0aW1lb3V0IiwibWFpbGNoZWNrRmFjdG9yeSIsIkRETyIsInJlc3RyaWN0IiwicmVxdWlyZSIsInNjb3BlIiwiYmluZFRvQ29udHJvbGxlciIsIm9wdGlvbnMiLCJjb250cm9sbGVyIiwiY29udHJvbGxlckFzIiwibGluayIsImVsZW1lbnQiLCJhdHRycyIsImN0cmxzIiwiY29uY2F0T3B0aW9ucyIsImRlc3QiLCJzcmMiLCJvcHRpb24iLCJoYXNPd25Qcm9wZXJ0eSIsImxlbmd0aCIsImNvbmNhdCIsIm1haWxjaGVja0RlZmF1bHRPcHRpb25zIiwibmdNb2RlbEN0cmwiLCJNQyIsInJlc3VsdCIsInRlbXBsYXRlU3RyIiwiZGVmYXVsdE9wdGlvbnMiLCJyZXBsYWNlT3B0aW9ucyIsImFuZ3VsYXIiLCJleHRlbmQiLCJkb21haW5zIiwiZGVmYXVsdERvbWFpbnMiLCJzZWNvbmRMZXZlbERvbWFpbnMiLCJkZWZhdWx0U2Vjb25kTGV2ZWxEb21haW5zIiwidG9wTGV2ZWxEb21haW5zIiwiZGVmYXVsdFRvcExldmVsRG9tYWlucyIsInN1Z2dlc3Rpb24iLCJhZnRlciIsIm9uIiwiZW1haWwiLCIkdmlld1ZhbHVlIiwicnVuIiwiJGV2YWxBc3luYyIsImNvcnJlY3RNZSIsInZhbCIsIiRzZXRWaWV3VmFsdWUiLCIkcmVuZGVyIiwiZG9tYWluIiwiJGluamVjdCIsIm1vZHVsZSIsImRpcmVjdGl2ZSIsIk1haWxjaGVjayIsImRvbWFpblRocmVzaG9sZCIsInNlY29uZExldmVsVGhyZXNob2xkIiwidG9wTGV2ZWxUaHJlc2hvbGQiLCJvcHRzIiwiZGlzdGFuY2VGdW5jdGlvbiIsInNpZnQ0RGlzdGFuY2UiLCJkZWZhdWx0Q2FsbGJhY2siLCJzdWdnZXN0ZWQiLCJlbXB0eSIsInN1Z2dlc3QiLCJlbmNvZGVFbWFpbCIsInRvTG93ZXJDYXNlIiwiZW1haWxQYXJ0cyIsInRoaXMiLCJzcGxpdEVtYWlsIiwiaW5kZXhPZiIsInNlY29uZExldmVsRG9tYWluIiwidG9wTGV2ZWxEb21haW4iLCJjbG9zZXN0RG9tYWluIiwiZmluZENsb3Nlc3REb21haW4iLCJhZGRyZXNzIiwiZnVsbCIsImNsb3Nlc3RTZWNvbmRMZXZlbERvbWFpbiIsImNsb3Nlc3RUb3BMZXZlbERvbWFpbiIsInJ0cm4iLCJyZXBsYWNlIiwiUmVnRXhwIiwidGhyZXNob2xkIiwiZGlzdCIsIm1pbkRpc3QiLCJJbmZpbml0eSIsImkiLCJzMSIsInMyIiwibWF4T2Zmc2V0IiwidW5kZWZpbmVkIiwibDEiLCJsMiIsImMxIiwiYzIiLCJsY3NzIiwibG9jYWxfY3MiLCJ0cmFucyIsIm9mZnNldF9hcnIiLCJjaGFyQXQiLCJpc1RyYW5zIiwib2ZzIiwiTWF0aCIsImFicyIsInNwbGljZSIsInB1c2giLCJtaW4iLCJqIiwicm91bmQiLCJtYXgiLCJwYXJ0cyIsInNwbGl0IiwicG9wIiwiZG9tYWluUGFydHMiLCJzbGQiLCJ0bGQiLCJzdWJzdHJpbmciLCJqb2luIiwiZW5jb2RlVVJJIiwiZmFjdG9yeSJdLCJtYXBwaW5ncyI6IkNBQ0MsV0FFRyxRQUFTQSxHQUFVQyxFQUFVQyxFQUFVQyxHQUNuQyxHQUFJQyxJQUNBQyxTQUFVLElBQ1ZDLFNBQVUsV0FBWSxjQUN0QkMsU0FDQUMsa0JBQ0lDLFFBQVMsS0FFYkMsV0FBWSxhQUNaQyxhQUFjLEtBQ2RDLEtBQU0sU0FBVUwsRUFBT00sRUFBU0MsRUFBT0MsR0FrRG5DLFFBQVNDLEdBQWNDLEVBQU1DLEdBQ3pCLEdBQUlDLEVBQ0osS0FBS0EsSUFBVUQsR0FDUEEsRUFBSUUsZUFBZUQsSUFDZkYsRUFBS0UsSUFBV0YsRUFBS0UsR0FBUUUsU0FDN0JKLEVBQUtFLEdBQVVELEVBQUlDLEdBQVFHLE9BQU9MLEVBQUtFLElBSW5ELE9BQU9GLEdBekRYLEdBU0lNLEdBVEFDLEVBQWNULEVBQU0sR0FDcEJVLEVBQUtWLEVBQU0s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QUlDLFVBQVUsRUFBR0QsRUFBSTdGLE9BQVMsR0FHeEMsT0FDSWtELGVBQWdCMkMsRUFDaEI1QyxrQkFBbUIyQyxFQUNuQmhFLE9BQVFBLEVBQ1J5QixRQUFTbUMsRUFBTU8sS0FBSyxPQU81QnBELFlBQWEsU0FBVXZCLEdBQ25CLEdBQUlmLEdBQVMyRixVQUFVNUUsRUFJdkIsT0FIQWYsR0FBU0EsRUFBT3FELFFBQVEsTUFBTyxLQUFLQSxRQUFRLE1BQU8sS0FBS0EsUUFBUSxNQUFPLEtBQ2xFQSxRQUFRLE1BQU8sS0FBS0EsUUFBUSxNQUFPLEtBQUtBLFFBQVEsTUFBTyxLQUN2REEsUUFBUSxNQUFPLE1BSTVCLE9BQU8xQixHQW5SWGxELEVBQWlCK0MsV0FzUmpCcEIsUUFDS3FCLE9BQU8sZUFDUG1FLFFBQVEsbUJBQW9CbkgiLCJmaWxlIjoibmctbWFpbGNoZWNrLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgbWFpbGNoZWNrLiRpbmplY3QgPSBbJyRjb21waWxlJywgJyR0aW1lb3V0JywgJ21haWxjaGVja0ZhY3RvcnknXTtcclxuICAgIGZ1bmN0aW9uIG1haWxjaGVjaygkY29tcGlsZSwgJHRpbWVvdXQsIG1haWxjaGVja0ZhY3RvcnkpIHtcclxuICAgICAgICB2YXIgRERPID0ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICByZXF1aXJlOiBbJz9uZ01vZGVsJywgJz9tYWlsY2hlY2snXSxcclxuICAgICAgICAgICAgc2NvcGU6IHt9LFxyXG4gICAgICAgICAgICBiaW5kVG9Db250cm9sbGVyOiB7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zOiAnPSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogZnVuY3Rpb24gKCkgeyB9LFxyXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICdNQycsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmxzKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBuZ01vZGVsIGlzIGFuIGFycmF5IFswXSBjb250YWlucyBuZ01vZGVsIFsxXSBjb250YWlucyBkaXJlY3RpdmUncyBjb250cm9sbGVyXHJcbiAgICAgICAgICAgICAgICB2YXIgbmdNb2RlbEN0cmwgPSBjdHJsc1swXSxcclxuICAgICAgICAgICAgICAgICAgICBNQyA9IGN0cmxzWzFdLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVTdHIgPSBNQy5vcHRpb25zLnRlbXBsYXRlU3RyIHx8ICc8cCBuZy1zaG93PVwiTUMuc3VnZ2VzdGlvbi5kb21haW5cIj5EaWQgeW91IG1lYW4gPGIgbmctY2xpY2s9XCJNQy5jb3JyZWN0TWUoTUMuc3VnZ2VzdGlvbi5mdWxsKVwiPjxpIG5nLWJpbmQ9XCJNQy5zdWdnZXN0aW9uLmZ1bGxcIj48L2k+PC9iPj88L3A+JyxcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0T3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVTdHI6IHRlbXBsYXRlU3RyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlT3B0aW9uczogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IGFuZ3VsYXIuZXh0ZW5kKHt9LCBkZWZhdWx0T3B0aW9ucywgTUMub3B0aW9ucyksXHJcbiAgICAgICAgICAgICAgICAgICAgbWFpbGNoZWNrRGVmYXVsdE9wdGlvbnM7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLnJlcGxhY2VPcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gbWFpbGNoZWNrRGVmYXVsdE9wdGlvbnMgPSBhbmd1bGFyLmNvcHkoe1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICBkb21haW5zOiBtYWlsY2hlY2tGYWN0b3J5LmRlZmF1bHREb21haW5zLFxyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICBzZWNvbmRMZXZlbERvbWFpbnM6IG1haWxjaGVja0ZhY3RvcnkuZGVmYXVsdFNlY29uZExldmVsRG9tYWlucyxcclxuICAgICAgICAgICAgICAgICAgICAvLyAgICAgdG9wTGV2ZWxEb21haW5zOiBtYWlsY2hlY2tGYWN0b3J5LmRlZmF1bHRUb3BMZXZlbERvbWFpbnNcclxuICAgICAgICAgICAgICAgICAgICAvLyB9KTtcclxuICAgICAgICAgICAgICAgICAgICBtYWlsY2hlY2tEZWZhdWx0T3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZG9tYWluczogbWFpbGNoZWNrRmFjdG9yeS5kZWZhdWx0RG9tYWlucyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2Vjb25kTGV2ZWxEb21haW5zOiBtYWlsY2hlY2tGYWN0b3J5LmRlZmF1bHRTZWNvbmRMZXZlbERvbWFpbnMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcExldmVsRG9tYWluczogbWFpbGNoZWNrRmFjdG9yeS5kZWZhdWx0VG9wTGV2ZWxEb21haW5zXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IGFuZ3VsYXIuZXh0ZW5kKHt9LCBkZWZhdWx0T3B0aW9ucywgY29uY2F0T3B0aW9ucyhNQy5vcHRpb25zLCBtYWlsY2hlY2tEZWZhdWx0T3B0aW9ucykpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLyogSW1wbGVtZW50YXRpb24gKi9cclxuXHJcbiAgICAgICAgICAgICAgICBNQy5zdWdnZXN0aW9uID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5hZnRlcigkY29tcGlsZShvcHRpb25zLnRlbXBsYXRlU3RyKShzY29wZSkpXHJcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9uKCdibHVyJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZW1haWwgPSBuZ01vZGVsQ3RybC4kdmlld1ZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIE1DLnN1Z2dlc3Rpb24gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBtYWlsY2hlY2tGYWN0b3J5LnJ1bihvcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kZXZhbEFzeW5jKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgTUMuc3VnZ2VzdGlvbiA9IHJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIE1DLmNvcnJlY3RNZSA9IGZ1bmN0aW9uICh2YWwpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZ01vZGVsQ3RybC4kc2V0Vmlld1ZhbHVlKHZhbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbmdNb2RlbEN0cmwuJHJlbmRlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRldmFsQXN5bmMoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBNQy5zdWdnZXN0aW9uLmRvbWFpbiA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLyogdXRpbGl0eSBmdW5jdGlvbiBmb3IgY29uY2F0ZW5hdGluZyB1c2VyIHNwZWNpZmllZCBvcHRpb25zIHdpdGggbWFpbGNoZWNrIGRlZmF1bHQgb3B0aW9ucyAqL1xyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gY29uY2F0T3B0aW9ucyhkZXN0LCBzcmMpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgb3B0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAob3B0aW9uIGluIHNyYykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3JjLmhhc093blByb3BlcnR5KG9wdGlvbikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkZXN0W29wdGlvbl0gJiYgZGVzdFtvcHRpb25dLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc3Rbb3B0aW9uXSA9IHNyY1tvcHRpb25dLmNvbmNhdChkZXN0W29wdGlvbl0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkZXN0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gRERPO1xyXG4gICAgfVxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ25nTWFpbGNoZWNrJywgW10pXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnbWFpbGNoZWNrJywgbWFpbGNoZWNrKTtcclxufSgpKSIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICBtYWlsY2hlY2tGYWN0b3J5LiRpbmplY3QgPSBbXTtcclxuICAgIGZ1bmN0aW9uIG1haWxjaGVja0ZhY3RvcnkoKSB7XHJcbiAgICAgICAgdmFyIE1haWxjaGVjayA9IHtcclxuICAgICAgICAgICAgZG9tYWluVGhyZXNob2xkOiAyLFxyXG4gICAgICAgICAgICBzZWNvbmRMZXZlbFRocmVzaG9sZDogMixcclxuICAgICAgICAgICAgdG9wTGV2ZWxUaHJlc2hvbGQ6IDIsXHJcblxyXG4gICAgICAgICAgICBkZWZhdWx0RG9tYWluczogWydtc24uY29tJywgJ2JlbGxzb3V0aC5uZXQnLFxyXG4gICAgICAgICAgICAgICAgJ3RlbHVzLm5ldCcsICdjb21jYXN0Lm5ldCcsICdvcHR1c25ldC5jb20uYXUnLFxyXG4gICAgICAgICAgICAgICAgJ2VhcnRobGluay5uZXQnLCAncXEuY29tJywgJ3NreS5jb20nLCAnaWNsb3VkLmNvbScsXHJcbiAgICAgICAgICAgICAgICAnbWFjLmNvbScsICdzeW1wYXRpY28uY2EnLCAnZ29vZ2xlbWFpbC5jb20nLFxyXG4gICAgICAgICAgICAgICAgJ2F0dC5uZXQnLCAneHRyYS5jby5ueicsICd3ZWIuZGUnLFxyXG4gICAgICAgICAgICAgICAgJ2NveC5uZXQnLCAnZ21haWwuY29tJywgJ3ltYWlsLmNvbScsXHJcbiAgICAgICAgICAgICAgICAnYWltLmNvbScsICdyb2dlcnMuY29tJywgJ3Zlcml6b24ubmV0JyxcclxuICAgICAgICAgICAgICAgICdyb2NrZXRtYWlsLmNvbScsICdnb29nbGUuY29tJywgJ29wdG9ubGluZS5uZXQnLFxyXG4gICAgICAgICAgICAgICAgJ3NiY2dsb2JhbC5uZXQnLCAnYW9sLmNvbScsICdtZS5jb20nLCAnYnRpbnRlcm5ldC5jb20nLFxyXG4gICAgICAgICAgICAgICAgJ2NoYXJ0ZXIubmV0JywgJ3NoYXcuY2EnXSxcclxuXHJcbiAgICAgICAgICAgIGRlZmF1bHRTZWNvbmRMZXZlbERvbWFpbnM6IFtcInlhaG9vXCIsIFwiaG90bWFpbFwiLCBcIm1haWxcIiwgXCJsaXZlXCIsIFwib3V0bG9va1wiLCBcImdteFwiXSxcclxuXHJcbiAgICAgICAgICAgIGRlZmF1bHRUb3BMZXZlbERvbWFpbnM6IFtcImNvbVwiLCBcImNvbS5hdVwiLCBcImNvbS50d1wiLCBcImNhXCIsIFwiY28ubnpcIiwgXCJjby51a1wiLCBcImRlXCIsXHJcbiAgICAgICAgICAgICAgICBcImZyXCIsIFwiaXRcIiwgXCJydVwiLCBcIm5ldFwiLCBcIm9yZ1wiLCBcImVkdVwiLCBcImdvdlwiLCBcImpwXCIsIFwibmxcIiwgXCJrclwiLCBcInNlXCIsIFwiZXVcIixcclxuICAgICAgICAgICAgICAgIFwiaWVcIiwgXCJjby5pbFwiLCBcInVzXCIsIFwiYXRcIiwgXCJiZVwiLCBcImRrXCIsIFwiaGtcIiwgXCJlc1wiLCBcImdyXCIsIFwiY2hcIiwgXCJub1wiLCBcImN6XCIsXHJcbiAgICAgICAgICAgICAgICBcImluXCIsIFwibmV0XCIsIFwibmV0LmF1XCIsIFwiaW5mb1wiLCBcImJpelwiLCBcIm1pbFwiLCBcImNvLmpwXCIsIFwic2dcIiwgXCJodVwiLCBcInVrXCJdLFxyXG5cclxuICAgICAgICAgICAgcnVuOiBmdW5jdGlvbiAob3B0cykge1xyXG4gICAgICAgICAgICAgICAgb3B0cy5kb21haW5zID0gb3B0cy5kb21haW5zIHx8IE1haWxjaGVjay5kZWZhdWx0RG9tYWlucztcclxuICAgICAgICAgICAgICAgIG9wdHMuc2Vjb25kTGV2ZWxEb21haW5zID0gb3B0cy5zZWNvbmRMZXZlbERvbWFpbnMgfHwgTWFpbGNoZWNrLmRlZmF1bHRTZWNvbmRMZXZlbERvbWFpbnM7XHJcbiAgICAgICAgICAgICAgICBvcHRzLnRvcExldmVsRG9tYWlucyA9IG9wdHMudG9wTGV2ZWxEb21haW5zIHx8IE1haWxjaGVjay5kZWZhdWx0VG9wTGV2ZWxEb21haW5zO1xyXG4gICAgICAgICAgICAgICAgb3B0cy5kaXN0YW5jZUZ1bmN0aW9uID0gb3B0cy5kaXN0YW5jZUZ1bmN0aW9uIHx8IE1haWxjaGVjay5zaWZ0NERpc3RhbmNlO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBkZWZhdWx0Q2FsbGJhY2sgPSBmdW5jdGlvbiAocmVzdWx0KSB7IHJldHVybiByZXN1bHQ7IH07XHJcbiAgICAgICAgICAgICAgICB2YXIgc3VnZ2VzdGVkQ2FsbGJhY2sgPSBvcHRzLnN1Z2dlc3RlZCB8fCBkZWZhdWx0Q2FsbGJhY2s7XHJcbiAgICAgICAgICAgICAgICB2YXIgZW1wdHlDYWxsYmFjayA9IG9wdHMuZW1wdHkgfHwgZGVmYXVsdENhbGxiYWNrO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBNYWlsY2hlY2suc3VnZ2VzdChNYWlsY2hlY2suZW5jb2RlRW1haWwob3B0cy5lbWFpbCksIG9wdHMuZG9tYWlucywgb3B0cy5zZWNvbmRMZXZlbERvbWFpbnMsIG9wdHMudG9wTGV2ZWxEb21haW5zLCBvcHRzLmRpc3RhbmNlRnVuY3Rpb24pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHJldHVybiByZXN1bHQgPyBzdWdnZXN0ZWRDYWxsYmFjayhyZXN1bHQpIDogZW1wdHlDYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgIHN1Z2dlc3Q6IGZ1bmN0aW9uIChlbWFpbCwgZG9tYWlucywgc2Vjb25kTGV2ZWxEb21haW5zLCB0b3BMZXZlbERvbWFpbnMsIGRpc3RhbmNlRnVuY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIGVtYWlsID0gZW1haWwudG9Mb3dlckNhc2UoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgZW1haWxQYXJ0cyA9IHRoaXMuc3BsaXRFbWFpbChlbWFpbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNlY29uZExldmVsRG9tYWlucyAmJiB0b3BMZXZlbERvbWFpbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgZW1haWwgaXMgYSB2YWxpZCAybmQtbGV2ZWwgKyB0b3AtbGV2ZWwsIGRvIG5vdCBzdWdnZXN0IGFueXRoaW5nLlxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWNvbmRMZXZlbERvbWFpbnMuaW5kZXhPZihlbWFpbFBhcnRzLnNlY29uZExldmVsRG9tYWluKSAhPT0gLTEgJiYgdG9wTGV2ZWxEb21haW5zLmluZGV4T2YoZW1haWxQYXJ0cy50b3BMZXZlbERvbWFpbikgIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGNsb3Nlc3REb21haW4gPSB0aGlzLmZpbmRDbG9zZXN0RG9tYWluKGVtYWlsUGFydHMuZG9tYWluLCBkb21haW5zLCBkaXN0YW5jZUZ1bmN0aW9uLCB0aGlzLmRvbWFpblRocmVzaG9sZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGNsb3Nlc3REb21haW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2xvc2VzdERvbWFpbiA9PSBlbWFpbFBhcnRzLmRvbWFpbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZW1haWwgYWRkcmVzcyBleGFjdGx5IG1hdGNoZXMgb25lIG9mIHRoZSBzdXBwbGllZCBkb21haW5zOyBkbyBub3QgcmV0dXJuIGEgc3VnZ2VzdGlvbi5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBlbWFpbCBhZGRyZXNzIGNsb3NlbHkgbWF0Y2hlcyBvbmUgb2YgdGhlIHN1cHBsaWVkIGRvbWFpbnM7IHJldHVybiBhIHN1Z2dlc3Rpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgYWRkcmVzczogZW1haWxQYXJ0cy5hZGRyZXNzLCBkb21haW46IGNsb3Nlc3REb21haW4sIGZ1bGw6IGVtYWlsUGFydHMuYWRkcmVzcyArIFwiQFwiICsgY2xvc2VzdERvbWFpbiB9O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBUaGUgZW1haWwgYWRkcmVzcyBkb2VzIG5vdCBjbG9zZWx5IG1hdGNoIG9uZSBvZiB0aGUgc3VwcGxpZWQgZG9tYWluc1xyXG4gICAgICAgICAgICAgICAgdmFyIGNsb3Nlc3RTZWNvbmRMZXZlbERvbWFpbiA9IHRoaXMuZmluZENsb3Nlc3REb21haW4oZW1haWxQYXJ0cy5zZWNvbmRMZXZlbERvbWFpbiwgc2Vjb25kTGV2ZWxEb21haW5zLCBkaXN0YW5jZUZ1bmN0aW9uLCB0aGlzLnNlY29uZExldmVsVGhyZXNob2xkKTtcclxuICAgICAgICAgICAgICAgIHZhciBjbG9zZXN0VG9wTGV2ZWxEb21haW4gPSB0aGlzLmZpbmRDbG9zZXN0RG9tYWluKGVtYWlsUGFydHMudG9wTGV2ZWxEb21haW4sIHRvcExldmVsRG9tYWlucywgZGlzdGFuY2VGdW5jdGlvbiwgdGhpcy50b3BMZXZlbFRocmVzaG9sZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGVtYWlsUGFydHMuZG9tYWluKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2xvc2VzdERvbWFpbiA9IGVtYWlsUGFydHMuZG9tYWluO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBydHJuID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjbG9zZXN0U2Vjb25kTGV2ZWxEb21haW4gJiYgY2xvc2VzdFNlY29uZExldmVsRG9tYWluICE9IGVtYWlsUGFydHMuc2Vjb25kTGV2ZWxEb21haW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGVtYWlsIGFkZHJlc3MgbWF5IGhhdmUgYSBtaXNwZWxsZWQgc2Vjb25kLWxldmVsIGRvbWFpbjsgcmV0dXJuIGEgc3VnZ2VzdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbG9zZXN0RG9tYWluID0gY2xvc2VzdERvbWFpbi5yZXBsYWNlKGVtYWlsUGFydHMuc2Vjb25kTGV2ZWxEb21haW4sIGNsb3Nlc3RTZWNvbmRMZXZlbERvbWFpbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ0cm4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNsb3Nlc3RUb3BMZXZlbERvbWFpbiAmJiBjbG9zZXN0VG9wTGV2ZWxEb21haW4gIT0gZW1haWxQYXJ0cy50b3BMZXZlbERvbWFpbiAmJiBlbWFpbFBhcnRzLnNlY29uZExldmVsRG9tYWluICE9PSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZW1haWwgYWRkcmVzcyBtYXkgaGF2ZSBhIG1pc3BlbGxlZCB0b3AtbGV2ZWwgZG9tYWluOyByZXR1cm4gYSBzdWdnZXN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3Nlc3REb21haW4gPSBjbG9zZXN0RG9tYWluLnJlcGxhY2UobmV3IFJlZ0V4cChlbWFpbFBhcnRzLnRvcExldmVsRG9tYWluICsgXCIkXCIpLCBjbG9zZXN0VG9wTGV2ZWxEb21haW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBydHJuID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChydHJuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7IGFkZHJlc3M6IGVtYWlsUGFydHMuYWRkcmVzcywgZG9tYWluOiBjbG9zZXN0RG9tYWluLCBmdWxsOiBlbWFpbFBhcnRzLmFkZHJlc3MgKyBcIkBcIiArIGNsb3Nlc3REb21haW4gfTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLyogVGhlIGVtYWlsIGFkZHJlc3MgZXhhY3RseSBtYXRjaGVzIG9uZSBvZiB0aGUgc3VwcGxpZWQgZG9tYWlucywgZG9lcyBub3QgY2xvc2VseVxyXG4gICAgICAgICAgICAgICAgICogbWF0Y2ggYW55IGRvbWFpbiBhbmQgZG9lcyBub3QgYXBwZWFyIHRvIHNpbXBseSBoYXZlIGEgbWlzcGVsbGVkIHRvcC1sZXZlbCBkb21haW4sXHJcbiAgICAgICAgICAgICAgICAgKiBvciBpcyBhbiBpbnZhbGlkIGVtYWlsIGFkZHJlc3M7IGRvIG5vdCByZXR1cm4gYSBzdWdnZXN0aW9uLlxyXG4gICAgICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICBmaW5kQ2xvc2VzdERvbWFpbjogZnVuY3Rpb24gKGRvbWFpbiwgZG9tYWlucywgZGlzdGFuY2VGdW5jdGlvbiwgdGhyZXNob2xkKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJlc2hvbGQgPSB0aHJlc2hvbGQgfHwgdGhpcy50b3BMZXZlbFRocmVzaG9sZDtcclxuICAgICAgICAgICAgICAgIHZhciBkaXN0O1xyXG4gICAgICAgICAgICAgICAgdmFyIG1pbkRpc3QgPSBJbmZpbml0eTtcclxuICAgICAgICAgICAgICAgIHZhciBjbG9zZXN0RG9tYWluID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIWRvbWFpbiB8fCAhZG9tYWlucykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghZGlzdGFuY2VGdW5jdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlRnVuY3Rpb24gPSB0aGlzLnNpZnQ0RGlzdGFuY2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkb21haW5zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRvbWFpbiA9PT0gZG9tYWluc1tpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZG9tYWluO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBkaXN0ID0gZGlzdGFuY2VGdW5jdGlvbihkb21haW4sIGRvbWFpbnNbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkaXN0IDwgbWluRGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtaW5EaXN0ID0gZGlzdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VzdERvbWFpbiA9IGRvbWFpbnNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChtaW5EaXN0IDw9IHRocmVzaG9sZCAmJiBjbG9zZXN0RG9tYWluICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNsb3Nlc3REb21haW47XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgIHNpZnQ0RGlzdGFuY2U6IGZ1bmN0aW9uIChzMSwgczIsIG1heE9mZnNldCkge1xyXG4gICAgICAgICAgICAgICAgLy8gc2lmdDQ6IGh0dHBzOi8vc2lkZXJpdGUuYmxvZ3Nwb3QuY29tLzIwMTQvMTEvc3VwZXItZmFzdC1hbmQtYWNjdXJhdGUtc3RyaW5nLWRpc3RhbmNlLmh0bWxcclxuICAgICAgICAgICAgICAgIGlmIChtYXhPZmZzZXQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1heE9mZnNldCA9IDU7IC8vZGVmYXVsdFxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICghczEgfHwgIXMxLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghczIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzMi5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFzMiB8fCAhczIubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHMxLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgbDEgPSBzMS5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICB2YXIgbDIgPSBzMi5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGMxID0gMDsgIC8vY3Vyc29yIGZvciBzdHJpbmcgMVxyXG4gICAgICAgICAgICAgICAgdmFyIGMyID0gMDsgIC8vY3Vyc29yIGZvciBzdHJpbmcgMlxyXG4gICAgICAgICAgICAgICAgdmFyIGxjc3MgPSAwOyAgLy9sYXJnZXN0IGNvbW1vbiBzdWJzZXF1ZW5jZVxyXG4gICAgICAgICAgICAgICAgdmFyIGxvY2FsX2NzID0gMDsgLy9sb2NhbCBjb21tb24gc3Vic3RyaW5nXHJcbiAgICAgICAgICAgICAgICB2YXIgdHJhbnMgPSAwOyAgLy9udW1iZXIgb2YgdHJhbnNwb3NpdGlvbnMgKCdhYicgdnMgJ2JhJylcclxuICAgICAgICAgICAgICAgIHZhciBvZmZzZXRfYXJyID0gW107ICAvL29mZnNldCBwYWlyIGFycmF5LCBmb3IgY29tcHV0aW5nIHRoZSB0cmFuc3Bvc2l0aW9uc1xyXG5cclxuICAgICAgICAgICAgICAgIHdoaWxlICgoYzEgPCBsMSkgJiYgKGMyIDwgbDIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHMxLmNoYXJBdChjMSkgPT0gczIuY2hhckF0KGMyKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9jcysrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXNUcmFucyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3NlZSBpZiBjdXJyZW50IG1hdGNoIGlzIGEgdHJhbnNwb3NpdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChpIDwgb2Zmc2V0X2Fyci5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvZnMgPSBvZmZzZXRfYXJyW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMxIDw9IG9mcy5jMSB8fCBjMiA8PSBvZnMuYzIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3aGVuIHR3byBtYXRjaGVzIGNyb3NzLCB0aGUgb25lIGNvbnNpZGVyZWQgYSB0cmFuc3Bvc2l0aW9uIGlzIHRoZSBvbmUgd2l0aCB0aGUgbGFyZ2VzdCBkaWZmZXJlbmNlIGluIG9mZnNldHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1RyYW5zID0gTWF0aC5hYnMoYzIgLSBjMSkgPj0gTWF0aC5hYnMob2ZzLmMyIC0gb2ZzLmMxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNUcmFucykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFucysrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghb2ZzLnRyYW5zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZnMudHJhbnMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnMrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMxID4gb2ZzLmMyICYmIGMyID4gb2ZzLmMxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldF9hcnIuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0X2Fyci5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMxOiBjMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMyOiBjMixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zOiBpc1RyYW5zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxjc3MgKz0gbG9jYWxfY3M7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsX2NzID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMxICE9IGMyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjMSA9IGMyID0gTWF0aC5taW4oYzEsIGMyKTsgIC8vdXNpbmcgbWluIGFsbG93cyB0aGUgY29tcHV0YXRpb24gb2YgdHJhbnNwb3NpdGlvbnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2lmIG1hdGNoaW5nIGNoYXJhY3RlcnMgYXJlIGZvdW5kLCByZW1vdmUgMSBmcm9tIGJvdGggY3Vyc29ycyAodGhleSBnZXQgaW5jcmVtZW50ZWQgYXQgdGhlIGVuZCBvZiB0aGUgbG9vcClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9zbyB0aGF0IHdlIGNhbiBoYXZlIG9ubHkgb25lIGNvZGUgYmxvY2sgaGFuZGxpbmcgbWF0Y2hlcyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBtYXhPZmZzZXQgJiYgKGMxICsgaiA8IGwxIHx8IGMyICsgaiA8IGwyKTsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGMxICsgaiA8IGwxKSAmJiAoczEuY2hhckF0KGMxICsgaikgPT0gczIuY2hhckF0KGMyKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjMSArPSBqIC0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjMi0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChjMiArIGogPCBsMikgJiYgKHMxLmNoYXJBdChjMSkgPT0gczIuY2hhckF0KGMyICsgaikpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYzEtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjMiArPSBqIC0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjMSsrO1xyXG4gICAgICAgICAgICAgICAgICAgIGMyKys7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcyBjb3ZlcnMgdGhlIGNhc2Ugd2hlcmUgdGhlIGxhc3QgbWF0Y2ggaXMgb24gdGhlIGxhc3QgdG9rZW4gaW4gbGlzdCwgc28gdGhhdCBpdCBjYW4gY29tcHV0ZSB0cmFuc3Bvc2l0aW9ucyBjb3JyZWN0bHlcclxuICAgICAgICAgICAgICAgICAgICBpZiAoKGMxID49IGwxKSB8fCAoYzIgPj0gbDIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxjc3MgKz0gbG9jYWxfY3M7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsX2NzID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYzEgPSBjMiA9IE1hdGgubWluKGMxLCBjMik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbGNzcyArPSBsb2NhbF9jcztcclxuICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKE1hdGgubWF4KGwxLCBsMikgLSBsY3NzICsgdHJhbnMpOyAvL2FkZCB0aGUgY29zdCBvZiB0cmFuc3Bvc2l0aW9ucyB0byB0aGUgZmluYWwgcmVzdWx0XHJcbiAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICBzcGxpdEVtYWlsOiBmdW5jdGlvbiAoZW1haWwpIHtcclxuICAgICAgICAgICAgICAgIGVtYWlsID0gZW1haWwgIT09IG51bGwgPyAoZW1haWwucmVwbGFjZSgvXlxccyovLCAnJykucmVwbGFjZSgvXFxzKiQvLCAnJykpIDogbnVsbDsgLy8gdHJpbSgpIG5vdCBleGlzdCBpbiBvbGQgSUUhXHJcbiAgICAgICAgICAgICAgICB2YXIgcGFydHMgPSBlbWFpbC5zcGxpdCgnQCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPCAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocGFydHNbaV0gPT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGRvbWFpbiA9IHBhcnRzLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRvbWFpblBhcnRzID0gZG9tYWluLnNwbGl0KCcuJyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2xkID0gJyc7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGxkID0gJyc7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGRvbWFpblBhcnRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSBhZGRyZXNzIGRvZXMgbm90IGhhdmUgYSB0b3AtbGV2ZWwgZG9tYWluXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkb21haW5QYXJ0cy5sZW5ndGggPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSBhZGRyZXNzIGhhcyBvbmx5IGEgdG9wLWxldmVsIGRvbWFpbiAodmFsaWQgdW5kZXIgUkZDKVxyXG4gICAgICAgICAgICAgICAgICAgIHRsZCA9IGRvbWFpblBhcnRzWzBdO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgYWRkcmVzcyBoYXMgYSBkb21haW4gYW5kIGEgdG9wLWxldmVsIGRvbWFpblxyXG4gICAgICAgICAgICAgICAgICAgIHNsZCA9IGRvbWFpblBhcnRzWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAxOyBqIDwgZG9tYWluUGFydHMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGxkICs9IGRvbWFpblBhcnRzW2pdICsgJy4nO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0bGQgPSB0bGQuc3Vic3RyaW5nKDAsIHRsZC5sZW5ndGggLSAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRvcExldmVsRG9tYWluOiB0bGQsXHJcbiAgICAgICAgICAgICAgICAgICAgc2Vjb25kTGV2ZWxEb21haW46IHNsZCxcclxuICAgICAgICAgICAgICAgICAgICBkb21haW46IGRvbWFpbixcclxuICAgICAgICAgICAgICAgICAgICBhZGRyZXNzOiBwYXJ0cy5qb2luKCdAJylcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICAvLyBFbmNvZGUgdGhlIGVtYWlsIGFkZHJlc3MgdG8gcHJldmVudCBYU1MgYnV0IGxlYXZlIGluIHZhbGlkXHJcbiAgICAgICAgICAgIC8vIGNoYXJhY3RlcnMsIGZvbGxvd2luZyB0aGlzIG9mZmljaWFsIHNwZWM6XHJcbiAgICAgICAgICAgIC8vIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRW1haWxfYWRkcmVzcyNTeW50YXhcclxuICAgICAgICAgICAgZW5jb2RlRW1haWw6IGZ1bmN0aW9uIChlbWFpbCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGVuY29kZVVSSShlbWFpbCk7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSByZXN1bHQucmVwbGFjZSgnJTIwJywgJyAnKS5yZXBsYWNlKCclMjUnLCAnJScpLnJlcGxhY2UoJyU1RScsICdeJylcclxuICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgnJTYwJywgJ2AnKS5yZXBsYWNlKCclN0InLCAneycpLnJlcGxhY2UoJyU3QycsICd8JylcclxuICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgnJTdEJywgJ30nKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBNYWlsY2hlY2s7XHJcbiAgICB9XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ25nTWFpbGNoZWNrJylcclxuICAgICAgICAuZmFjdG9yeSgnbWFpbGNoZWNrRmFjdG9yeScsIG1haWxjaGVja0ZhY3RvcnkpO1xyXG5cclxufSAoKSk7Il19

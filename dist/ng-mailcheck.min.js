!function(){function e(e,n,o){var t={restrict:"A",require:["?ngModel","?mailcheck"],scope:{},bindToController:{options:"="},controller:function(){},controllerAs:"MC",link:function(n,t,i,a){function l(e,n){var o;for(o in n)n.hasOwnProperty(o)&&e[o]&&e[o].length&&(e[o]=n[o].concat(e[o]));return e}var r=/email|search|text/i;if(!i.ngModel)throw new Error("element must contain ng-model attribute");if("INPUT"!==t[0].nodeName||!r.test(i.type))throw new Error("mailcheck element is limited to text, email, search input types only");var s,c=a[0],m=a[1],u=null,d=m.options.templateStr||'<p ng-show="MC.suggestion.domain">Did you mean <b ng-click="MC.correctMe(MC.suggestion.full)"><i ng-bind="MC.suggestion.full"></i></b>?</p>',h={templateStr:d,replaceOptions:!0},f=angular.extend({},h,m.options);f.replaceOptions||(s={domains:o.defaultDomains,secondLevelDomains:o.defaultSecondLevelDomains,topLevelDomains:o.defaultTopLevelDomains},f=angular.extend({},h,l(m.options,s))),m.suggestion=!1,t.after(e(f.templateStr)(n)),t.on("blur",function(){f.email=c.$viewValue,m.suggestion=!1,u=o.run(f),n.$evalAsync(function(){m.suggestion=u})}),m.correctMe=function(e){c.$setViewValue(e),c.$render(),n.$evalAsync(function(){m.suggestion.domain=null})}}};return t}e.$inject=["$compile","$timeout","mailcheckFactory"],angular.module("ngMailcheck",[]).directive("mailcheck",e)}(),function(){function e(){var e={domainThreshold:2,secondLevelThreshold:2,topLevelThreshold:2,defaultDomains:["msn.com","bellsouth.net","telus.net","comcast.net","optusnet.com.au","earthlink.net","qq.com","sky.com","icloud.com","mac.com","sympatico.ca","googlemail.com","att.net","xtra.co.nz","web.de","cox.net","gmail.com","ymail.com","aim.com","rogers.com","verizon.net","rocketmail.com","google.com","optonline.net","sbcglobal.net","aol.com","me.com","btinternet.com","charter.net","shaw.ca"],defaultSecondLevelDomains:["yahoo","hotmail","mail","live","outlook","gmx"],defaultTopLevelDomains:["com","com.au","com.tw","ca","co.nz","co.uk","de","fr","it","ru","net","org","edu","gov","jp","nl","kr","se","eu","ie","co.il","us","at","be","dk","hk","es","gr","ch","no","cz","in","net","net.au","info","biz","mil","co.jp","sg","hu","uk"],run:function(n){n.domains=n.domains||e.defaultDomains,n.secondLevelDomains=n.secondLevelDomains||e.defaultSecondLevelDomains,n.topLevelDomains=n.topLevelDomains||e.defaultTopLevelDomains,n.distanceFunction=n.distanceFunction||e.sift4Distance;var o=function(e){return e},t=(n.suggested||o,n.empty||o,e.suggest(e.encodeEmail(n.email),n.domains,n.secondLevelDomains,n.topLevelDomains,n.distanceFunction));return t},suggest:function(e,n,o,t,i){e=e.toLowerCase();var a=this.splitEmail(e);if(o&&t&&o.indexOf(a.secondLevelDomain)!==-1&&t.indexOf(a.topLevelDomain)!==-1)return!1;var l=this.findClosestDomain(a.domain,n,i,this.domainThreshold);if(l)return l!=a.domain&&{address:a.address,domain:l,full:a.address+"@"+l};var r=this.findClosestDomain(a.secondLevelDomain,o,i,this.secondLevelThreshold),s=this.findClosestDomain(a.topLevelDomain,t,i,this.topLevelThreshold);if(a.domain){l=a.domain;var c=!1;if(r&&r!=a.secondLevelDomain&&(l=l.replace(a.secondLevelDomain,r),c=!0),s&&s!=a.topLevelDomain&&""!==a.secondLevelDomain&&(l=l.replace(new RegExp(a.topLevelDomain+"$"),s),c=!0),c)return{address:a.address,domain:l,full:a.address+"@"+l}}return!1},findClosestDomain:function(e,n,o,t){t=t||this.topLevelThreshold;var i,a=1/0,l=null;if(!e||!n)return!1;o||(o=this.sift4Distance);for(var r=0;r<n.length;r++){if(e===n[r])return e;i=o(e,n[r]),i<a&&(a=i,l=n[r])}return a<=t&&null!==l&&l},sift4Distance:function(e,n,o){if(void 0===o&&(o=5),!e||!e.length)return n?n.length:0;if(!n||!n.length)return e.length;for(var t=e.length,i=n.length,a=0,l=0,r=0,s=0,c=0,m=[];a<t&&l<i;){if(e.charAt(a)==n.charAt(l)){s++;for(var u=!1,d=0;d<m.length;){var h=m[d];if(a<=h.c1||l<=h.c2){u=Math.abs(l-a)>=Math.abs(h.c2-h.c1),u?c++:h.trans||(h.trans=!0,c++);break}a>h.c2&&l>h.c1?m.splice(d,1):d++}m.push({c1:a,c2:l,trans:u})}else{r+=s,s=0,a!=l&&(a=l=Math.min(a,l));for(var f=0;f<o&&(a+f<t||l+f<i);f++){if(a+f<t&&e.charAt(a+f)==n.charAt(l)){a+=f-1,l--;break}if(l+f<i&&e.charAt(a)==n.charAt(l+f)){a--,l+=f-1;break}}}a++,l++,(a>=t||l>=i)&&(r+=s,s=0,a=l=Math.min(a,l))}return r+=s,Math.round(Math.max(t,i)-r+c)},splitEmail:function(e){e=null!==e?e.replace(/^\s*/,"").replace(/\s*$/,""):null;var n=e.split("@");if(n.length<2)return!1;for(var o=0;o<n.length;o++)if(""===n[o])return!1;var t=n.pop(),i=t.split("."),a="",l="";if(0===i.length)return!1;if(1==i.length)l=i[0];else{a=i[0];for(var r=1;r<i.length;r++)l+=i[r]+".";l=l.substring(0,l.length-1)}return{topLevelDomain:l,secondLevelDomain:a,domain:t,address:n.join("@")}},encodeEmail:function(e){var n=encodeURI(e);return n=n.replace("%20"," ").replace("%25","%").replace("%5E","^").replace("%60","`").replace("%7B","{").replace("%7C","|").replace("%7D","}")}};return e}e.$inject=[],angular.module("ngMailcheck").factory("mailcheckFactory",e)}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haWxjaGVjay5kaXJlY3RpdmUuanMiLCJtYWlsY2hlY2suZmFjdG9yeS5qcyJdLCJuYW1lcyI6WyJtYWlsY2hlY2siLCIkY29tcGlsZSIsIiR0aW1lb3V0IiwibWFpbGNoZWNrRmFjdG9yeSIsIkRETyIsInJlc3RyaWN0IiwicmVxdWlyZSIsInNjb3BlIiwiYmluZFRvQ29udHJvbGxlciIsIm9wdGlvbnMiLCJjb250cm9sbGVyIiwiY29udHJvbGxlckFzIiwibGluayIsImVsZW1lbnQiLCJhdHRycyIsImN0cmxzIiwiY29uY2F0T3B0aW9ucyIsImRlc3QiLCJzcmMiLCJvcHRpb24iLCJoYXNPd25Qcm9wZXJ0eSIsImxlbmd0aCIsImNvbmNhdCIsInJlc3RyaWN0ZWRUeXBlcyIsIm5nTW9kZWwiLCJFcnJvciIsIm5vZGVOYW1lIiwidGVzdCIsInR5cGUiLCJtYWlsY2hlY2tEZWZhdWx0T3B0aW9ucyIsIm5nTW9kZWxDdHJsIiwiTUMiLCJyZXN1bHQiLCJ0ZW1wbGF0ZVN0ciIsImRlZmF1bHRPcHRpb25zIiwicmVwbGFjZU9wdGlvbnMiLCJhbmd1bGFyIiwiZXh0ZW5kIiwiZG9tYWlucyIsImRlZmF1bHREb21haW5zIiwic2Vjb25kTGV2ZWxEb21haW5zIiwiZGVmYXVsdFNlY29uZExldmVsRG9tYWlucyIsInRvcExldmVsRG9tYWlucyIsImRlZmF1bHRUb3BMZXZlbERvbWFpbnMiLCJzdWdnZXN0aW9uIiwiYWZ0ZXIiLCJvbiIsImVtYWlsIiwiJHZpZXdWYWx1ZSIsInJ1biIsIiRldmFsQXN5bmMiLCJjb3JyZWN0TWUiLCJ2YWwiLCIkc2V0Vmlld1ZhbHVlIiwiJHJlbmRlciIsImRvbWFpbiIsIiRpbmplY3QiLCJtb2R1bGUiLCJkaXJlY3RpdmUiLCJNYWlsY2hlY2siLCJkb21haW5UaHJlc2hvbGQiLCJzZWNvbmRMZXZlbFRocmVzaG9sZCIsInRvcExldmVsVGhyZXNob2xkIiwib3B0cyIsImRpc3RhbmNlRnVuY3Rpb24iLCJzaWZ0NERpc3RhbmNlIiwiZGVmYXVsdENhbGxiYWNrIiwic3VnZ2VzdGVkIiwiZW1wdHkiLCJzdWdnZXN0IiwiZW5jb2RlRW1haWwiLCJ0b0xvd2VyQ2FzZSIsImVtYWlsUGFydHMiLCJ0aGlzIiwic3BsaXRFbWFpbCIsImluZGV4T2YiLCJzZWNvbmRMZXZlbERvbWFpbiIsInRvcExldmVsRG9tYWluIiwiY2xvc2VzdERvbWFpbiIsImZpbmRDbG9zZXN0RG9tYWluIiwiYWRkcmVzcyIsImZ1bGwiLCJjbG9zZXN0U2Vjb25kTGV2ZWxEb21haW4iLCJjbG9zZXN0VG9wTGV2ZWxEb21haW4iLCJydHJuIiwicmVwbGFjZSIsIlJlZ0V4cCIsInRocmVzaG9sZCIsImRpc3QiLCJtaW5EaXN0IiwiSW5maW5pdHkiLCJpIiwiczEiLCJzMiIsIm1heE9mZnNldCIsInVuZGVmaW5lZCIsImwxIiwibDIiLCJjMSIsImMyIiwibGNzcyIsImxvY2FsX2NzIiwidHJhbnMiLCJvZmZzZXRfYXJyIiwiY2hhckF0IiwiaXNUcmFucyIsIm9mcyIsIk1hdGgiLCJhYnMiLCJzcGxpY2UiLCJwdXNoIiwibWluIiwiaiIsInJvdW5kIiwibWF4IiwicGFydHMiLCJzcGxpdCIsInBvcCIsImRvbWFpblBhcnRzIiwic2xkIiwidGxkIiwic3Vic3RyaW5nIiwiam9pbiIsImVuY29kZVVSSSIsImZhY3RvcnkiXSwibWFwcGluZ3MiOiJDQUFBLFdBRUEsUUFBQUEsR0FBQUMsRUFBQUMsRUFBQUMsR0FDQSxHQUFBQyxJQUNBQyxTQUFBLElBQ0FDLFNBQUEsV0FBQSxjQUNBQyxTQUNBQyxrQkFDQUMsUUFBQSxLQUVBQyxXQUFBLGFBQ0FDLGFBQUEsS0FDQUMsS0FBQSxTQUFBTCxFQUFBTSxFQUFBQyxFQUFBQyxHQXFEQSxRQUFBQyxHQUFBQyxFQUFBQyxHQUNBLEdBQUFDLEVBQ0EsS0FBQUEsSUFBQUQsR0FDQUEsRUFBQUUsZUFBQUQsSUFDQUYsRUFBQUUsSUFBQUYsRUFBQUUsR0FBQUUsU0FDQUosRUFBQUUsR0FBQUQsRUFBQUMsR0FBQUcsT0FBQUwsRUFBQUUsSUFJ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QUFBLEdBRUFRLEdBQUFBLEVBQUFDLFVBQUEsRUFBQUQsRUFBQW5HLE9BQUEsR0FHQSxPQUNBd0QsZUFBQTJDLEVBQ0E1QyxrQkFBQTJDLEVBQ0FoRSxPQUFBQSxFQUNBeUIsUUFBQW1DLEVBQUFPLEtBQUEsT0FPQXBELFlBQUEsU0FBQXZCLEdBQ0EsR0FBQWYsR0FBQTJGLFVBQUE1RSxFQUlBLE9BSEFmLEdBQUFBLEVBQUFxRCxRQUFBLE1BQUEsS0FBQUEsUUFBQSxNQUFBLEtBQUFBLFFBQUEsTUFBQSxLQUNBQSxRQUFBLE1BQUEsS0FBQUEsUUFBQSxNQUFBLEtBQUFBLFFBQUEsTUFBQSxLQUNBQSxRQUFBLE1BQUEsTUFJQSxPQUFBMUIsR0FuUkF4RCxFQUFBcUQsV0FzUkFwQixRQUNBcUIsT0FBQSxlQUNBbUUsUUFBQSxtQkFBQXpIIiwiZmlsZSI6Im5nLW1haWxjaGVjay5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XHJcbiAgICBtYWlsY2hlY2suJGluamVjdCA9IFsnJGNvbXBpbGUnLCAnJHRpbWVvdXQnLCAnbWFpbGNoZWNrRmFjdG9yeSddO1xyXG4gICAgZnVuY3Rpb24gbWFpbGNoZWNrKCRjb21waWxlLCAkdGltZW91dCwgbWFpbGNoZWNrRmFjdG9yeSkge1xyXG4gICAgICAgIHZhciBERE8gPSB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6IFsnP25nTW9kZWwnLCAnP21haWxjaGVjayddLFxyXG4gICAgICAgICAgICBzY29wZToge30sXHJcbiAgICAgICAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnM6ICc9J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbiAoKSB7IH0sXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ01DJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycywgY3RybHMpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXN0cmljdGVkVHlwZXMgPSAvZW1haWx8c2VhcmNofHRleHQvaTtcclxuICAgICAgICAgICAgICAgIGlmICghYXR0cnMubmdNb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImVsZW1lbnQgbXVzdCBjb250YWluIG5nLW1vZGVsIGF0dHJpYnV0ZVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50WzBdLm5vZGVOYW1lICE9PSBcIklOUFVUXCIgfHwgIXJlc3RyaWN0ZWRUeXBlcy50ZXN0KGF0dHJzLnR5cGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwibWFpbGNoZWNrIGVsZW1lbnQgaXMgbGltaXRlZCB0byB0ZXh0LCBlbWFpbCwgc2VhcmNoIGlucHV0IHR5cGVzIG9ubHlcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gY3RybHMgaXMgYW4gYXJyYXkuIFswXSBjb250YWlucyBuZ01vZGVsLCBbMV0gY29udGFpbnMgZGlyZWN0aXZlJ3MgY29udHJvbGxlclxyXG4gICAgICAgICAgICAgICAgdmFyIG5nTW9kZWxDdHJsID0gY3RybHNbMF0sXHJcbiAgICAgICAgICAgICAgICAgICAgTUMgPSBjdHJsc1sxXSxcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlU3RyID0gTUMub3B0aW9ucy50ZW1wbGF0ZVN0ciB8fCAnPHAgbmctc2hvdz1cIk1DLnN1Z2dlc3Rpb24uZG9tYWluXCI+RGlkIHlvdSBtZWFuIDxiIG5nLWNsaWNrPVwiTUMuY29ycmVjdE1lKE1DLnN1Z2dlc3Rpb24uZnVsbClcIj48aSBuZy1iaW5kPVwiTUMuc3VnZ2VzdGlvbi5mdWxsXCI+PC9pPjwvYj4/PC9wPicsXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlU3RyOiB0ZW1wbGF0ZVN0cixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZU9wdGlvbnM6IHRydWVcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBhbmd1bGFyLmV4dGVuZCh7fSwgZGVmYXVsdE9wdGlvbnMsIE1DLm9wdGlvbnMpLFxyXG4gICAgICAgICAgICAgICAgICAgIG1haWxjaGVja0RlZmF1bHRPcHRpb25zO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5yZXBsYWNlT3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIG1haWxjaGVja0RlZmF1bHRPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkb21haW5zOiBtYWlsY2hlY2tGYWN0b3J5LmRlZmF1bHREb21haW5zLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRMZXZlbERvbWFpbnM6IG1haWxjaGVja0ZhY3RvcnkuZGVmYXVsdFNlY29uZExldmVsRG9tYWlucyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9wTGV2ZWxEb21haW5zOiBtYWlsY2hlY2tGYWN0b3J5LmRlZmF1bHRUb3BMZXZlbERvbWFpbnNcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gYW5ndWxhci5leHRlbmQoe30sIGRlZmF1bHRPcHRpb25zLCBjb25jYXRPcHRpb25zKE1DLm9wdGlvbnMsIG1haWxjaGVja0RlZmF1bHRPcHRpb25zKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvKiBJbXBsZW1lbnRhdGlvbiAqL1xyXG5cclxuICAgICAgICAgICAgICAgIE1DLnN1Z2dlc3Rpb24gPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmFmdGVyKCRjb21waWxlKG9wdGlvbnMudGVtcGxhdGVTdHIpKHNjb3BlKSlcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQub24oJ2JsdXInLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5lbWFpbCA9IG5nTW9kZWxDdHJsLiR2aWV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgTUMuc3VnZ2VzdGlvbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IG1haWxjaGVja0ZhY3RvcnkucnVuKG9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRldmFsQXN5bmMoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBNQy5zdWdnZXN0aW9uID0gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgTUMuY29ycmVjdE1lID0gZnVuY3Rpb24gKHZhbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5nTW9kZWxDdHJsLiRzZXRWaWV3VmFsdWUodmFsKTtcclxuICAgICAgICAgICAgICAgICAgICBuZ01vZGVsQ3RybC4kcmVuZGVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGV2YWxBc3luYyhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE1DLnN1Z2dlc3Rpb24uZG9tYWluID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvKiB1dGlsaXR5IGZ1bmN0aW9uIGZvciBjb25jYXRlbmF0aW5nIHVzZXIgc3BlY2lmaWVkIG9wdGlvbnMgd2l0aCBtYWlsY2hlY2sgZGVmYXVsdCBvcHRpb25zICovXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBjb25jYXRPcHRpb25zKGRlc3QsIHNyYykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvcHRpb247XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChvcHRpb24gaW4gc3JjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzcmMuaGFzT3duUHJvcGVydHkob3B0aW9uKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRlc3Rbb3B0aW9uXSAmJiBkZXN0W29wdGlvbl0ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdFtvcHRpb25dID0gc3JjW29wdGlvbl0uY29uY2F0KGRlc3Rbb3B0aW9uXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlc3Q7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBERE87XHJcbiAgICB9XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnbmdNYWlsY2hlY2snLCBbXSlcclxuICAgICAgICAuZGlyZWN0aXZlKCdtYWlsY2hlY2snLCBtYWlsY2hlY2spO1xyXG59KCkpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICBtYWlsY2hlY2tGYWN0b3J5LiRpbmplY3QgPSBbXTtcclxuICAgIGZ1bmN0aW9uIG1haWxjaGVja0ZhY3RvcnkoKSB7XHJcbiAgICAgICAgdmFyIE1haWxjaGVjayA9IHtcclxuICAgICAgICAgICAgZG9tYWluVGhyZXNob2xkOiAyLFxyXG4gICAgICAgICAgICBzZWNvbmRMZXZlbFRocmVzaG9sZDogMixcclxuICAgICAgICAgICAgdG9wTGV2ZWxUaHJlc2hvbGQ6IDIsXHJcblxyXG4gICAgICAgICAgICBkZWZhdWx0RG9tYWluczogWydtc24uY29tJywgJ2JlbGxzb3V0aC5uZXQnLFxyXG4gICAgICAgICAgICAgICAgJ3RlbHVzLm5ldCcsICdjb21jYXN0Lm5ldCcsICdvcHR1c25ldC5jb20uYXUnLFxyXG4gICAgICAgICAgICAgICAgJ2VhcnRobGluay5uZXQnLCAncXEuY29tJywgJ3NreS5jb20nLCAnaWNsb3VkLmNvbScsXHJcbiAgICAgICAgICAgICAgICAnbWFjLmNvbScsICdzeW1wYXRpY28uY2EnLCAnZ29vZ2xlbWFpbC5jb20nLFxyXG4gICAgICAgICAgICAgICAgJ2F0dC5uZXQnLCAneHRyYS5jby5ueicsICd3ZWIuZGUnLFxyXG4gICAgICAgICAgICAgICAgJ2NveC5uZXQnLCAnZ21haWwuY29tJywgJ3ltYWlsLmNvbScsXHJcbiAgICAgICAgICAgICAgICAnYWltLmNvbScsICdyb2dlcnMuY29tJywgJ3Zlcml6b24ubmV0JyxcclxuICAgICAgICAgICAgICAgICdyb2NrZXRtYWlsLmNvbScsICdnb29nbGUuY29tJywgJ29wdG9ubGluZS5uZXQnLFxyXG4gICAgICAgICAgICAgICAgJ3NiY2dsb2JhbC5uZXQnLCAnYW9sLmNvbScsICdtZS5jb20nLCAnYnRpbnRlcm5ldC5jb20nLFxyXG4gICAgICAgICAgICAgICAgJ2NoYXJ0ZXIubmV0JywgJ3NoYXcuY2EnXSxcclxuXHJcbiAgICAgICAgICAgIGRlZmF1bHRTZWNvbmRMZXZlbERvbWFpbnM6IFtcInlhaG9vXCIsIFwiaG90bWFpbFwiLCBcIm1haWxcIiwgXCJsaXZlXCIsIFwib3V0bG9va1wiLCBcImdteFwiXSxcclxuXHJcbiAgICAgICAgICAgIGRlZmF1bHRUb3BMZXZlbERvbWFpbnM6IFtcImNvbVwiLCBcImNvbS5hdVwiLCBcImNvbS50d1wiLCBcImNhXCIsIFwiY28ubnpcIiwgXCJjby51a1wiLCBcImRlXCIsXHJcbiAgICAgICAgICAgICAgICBcImZyXCIsIFwiaXRcIiwgXCJydVwiLCBcIm5ldFwiLCBcIm9yZ1wiLCBcImVkdVwiLCBcImdvdlwiLCBcImpwXCIsIFwibmxcIiwgXCJrclwiLCBcInNlXCIsIFwiZXVcIixcclxuICAgICAgICAgICAgICAgIFwiaWVcIiwgXCJjby5pbFwiLCBcInVzXCIsIFwiYXRcIiwgXCJiZVwiLCBcImRrXCIsIFwiaGtcIiwgXCJlc1wiLCBcImdyXCIsIFwiY2hcIiwgXCJub1wiLCBcImN6XCIsXHJcbiAgICAgICAgICAgICAgICBcImluXCIsIFwibmV0XCIsIFwibmV0LmF1XCIsIFwiaW5mb1wiLCBcImJpelwiLCBcIm1pbFwiLCBcImNvLmpwXCIsIFwic2dcIiwgXCJodVwiLCBcInVrXCJdLFxyXG5cclxuICAgICAgICAgICAgcnVuOiBmdW5jdGlvbiAob3B0cykge1xyXG4gICAgICAgICAgICAgICAgb3B0cy5kb21haW5zID0gb3B0cy5kb21haW5zIHx8IE1haWxjaGVjay5kZWZhdWx0RG9tYWlucztcclxuICAgICAgICAgICAgICAgIG9wdHMuc2Vjb25kTGV2ZWxEb21haW5zID0gb3B0cy5zZWNvbmRMZXZlbERvbWFpbnMgfHwgTWFpbGNoZWNrLmRlZmF1bHRTZWNvbmRMZXZlbERvbWFpbnM7XHJcbiAgICAgICAgICAgICAgICBvcHRzLnRvcExldmVsRG9tYWlucyA9IG9wdHMudG9wTGV2ZWxEb21haW5zIHx8IE1haWxjaGVjay5kZWZhdWx0VG9wTGV2ZWxEb21haW5zO1xyXG4gICAgICAgICAgICAgICAgb3B0cy5kaXN0YW5jZUZ1bmN0aW9uID0gb3B0cy5kaXN0YW5jZUZ1bmN0aW9uIHx8IE1haWxjaGVjay5zaWZ0NERpc3RhbmNlO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBkZWZhdWx0Q2FsbGJhY2sgPSBmdW5jdGlvbiAocmVzdWx0KSB7IHJldHVybiByZXN1bHQ7IH07XHJcbiAgICAgICAgICAgICAgICB2YXIgc3VnZ2VzdGVkQ2FsbGJhY2sgPSBvcHRzLnN1Z2dlc3RlZCB8fCBkZWZhdWx0Q2FsbGJhY2s7XHJcbiAgICAgICAgICAgICAgICB2YXIgZW1wdHlDYWxsYmFjayA9IG9wdHMuZW1wdHkgfHwgZGVmYXVsdENhbGxiYWNrO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBNYWlsY2hlY2suc3VnZ2VzdChNYWlsY2hlY2suZW5jb2RlRW1haWwob3B0cy5lbWFpbCksIG9wdHMuZG9tYWlucywgb3B0cy5zZWNvbmRMZXZlbERvbWFpbnMsIG9wdHMudG9wTGV2ZWxEb21haW5zLCBvcHRzLmRpc3RhbmNlRnVuY3Rpb24pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIHJldHVybiByZXN1bHQgPyBzdWdnZXN0ZWRDYWxsYmFjayhyZXN1bHQpIDogZW1wdHlDYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgIHN1Z2dlc3Q6IGZ1bmN0aW9uIChlbWFpbCwgZG9tYWlucywgc2Vjb25kTGV2ZWxEb21haW5zLCB0b3BMZXZlbERvbWFpbnMsIGRpc3RhbmNlRnVuY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIGVtYWlsID0gZW1haWwudG9Mb3dlckNhc2UoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgZW1haWxQYXJ0cyA9IHRoaXMuc3BsaXRFbWFpbChlbWFpbCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNlY29uZExldmVsRG9tYWlucyAmJiB0b3BMZXZlbERvbWFpbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgZW1haWwgaXMgYSB2YWxpZCAybmQtbGV2ZWwgKyB0b3AtbGV2ZWwsIGRvIG5vdCBzdWdnZXN0IGFueXRoaW5nLlxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWNvbmRMZXZlbERvbWFpbnMuaW5kZXhPZihlbWFpbFBhcnRzLnNlY29uZExldmVsRG9tYWluKSAhPT0gLTEgJiYgdG9wTGV2ZWxEb21haW5zLmluZGV4T2YoZW1haWxQYXJ0cy50b3BMZXZlbERvbWFpbikgIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGNsb3Nlc3REb21haW4gPSB0aGlzLmZpbmRDbG9zZXN0RG9tYWluKGVtYWlsUGFydHMuZG9tYWluLCBkb21haW5zLCBkaXN0YW5jZUZ1bmN0aW9uLCB0aGlzLmRvbWFpblRocmVzaG9sZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGNsb3Nlc3REb21haW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2xvc2VzdERvbWFpbiA9PSBlbWFpbFBhcnRzLmRvbWFpbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZW1haWwgYWRkcmVzcyBleGFjdGx5IG1hdGNoZXMgb25lIG9mIHRoZSBzdXBwbGllZCBkb21haW5zOyBkbyBub3QgcmV0dXJuIGEgc3VnZ2VzdGlvbi5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBlbWFpbCBhZGRyZXNzIGNsb3NlbHkgbWF0Y2hlcyBvbmUgb2YgdGhlIHN1cHBsaWVkIGRvbWFpbnM7IHJldHVybiBhIHN1Z2dlc3Rpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgYWRkcmVzczogZW1haWxQYXJ0cy5hZGRyZXNzLCBkb21haW46IGNsb3Nlc3REb21haW4sIGZ1bGw6IGVtYWlsUGFydHMuYWRkcmVzcyArIFwiQFwiICsgY2xvc2VzdERvbWFpbiB9O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBUaGUgZW1haWwgYWRkcmVzcyBkb2VzIG5vdCBjbG9zZWx5IG1hdGNoIG9uZSBvZiB0aGUgc3VwcGxpZWQgZG9tYWluc1xyXG4gICAgICAgICAgICAgICAgdmFyIGNsb3Nlc3RTZWNvbmRMZXZlbERvbWFpbiA9IHRoaXMuZmluZENsb3Nlc3REb21haW4oZW1haWxQYXJ0cy5zZWNvbmRMZXZlbERvbWFpbiwgc2Vjb25kTGV2ZWxEb21haW5zLCBkaXN0YW5jZUZ1bmN0aW9uLCB0aGlzLnNlY29uZExldmVsVGhyZXNob2xkKTtcclxuICAgICAgICAgICAgICAgIHZhciBjbG9zZXN0VG9wTGV2ZWxEb21haW4gPSB0aGlzLmZpbmRDbG9zZXN0RG9tYWluKGVtYWlsUGFydHMudG9wTGV2ZWxEb21haW4sIHRvcExldmVsRG9tYWlucywgZGlzdGFuY2VGdW5jdGlvbiwgdGhpcy50b3BMZXZlbFRocmVzaG9sZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGVtYWlsUGFydHMuZG9tYWluKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2xvc2VzdERvbWFpbiA9IGVtYWlsUGFydHMuZG9tYWluO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBydHJuID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjbG9zZXN0U2Vjb25kTGV2ZWxEb21haW4gJiYgY2xvc2VzdFNlY29uZExldmVsRG9tYWluICE9IGVtYWlsUGFydHMuc2Vjb25kTGV2ZWxEb21haW4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGVtYWlsIGFkZHJlc3MgbWF5IGhhdmUgYSBtaXNwZWxsZWQgc2Vjb25kLWxldmVsIGRvbWFpbjsgcmV0dXJuIGEgc3VnZ2VzdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbG9zZXN0RG9tYWluID0gY2xvc2VzdERvbWFpbi5yZXBsYWNlKGVtYWlsUGFydHMuc2Vjb25kTGV2ZWxEb21haW4sIGNsb3Nlc3RTZWNvbmRMZXZlbERvbWFpbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ0cm4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNsb3Nlc3RUb3BMZXZlbERvbWFpbiAmJiBjbG9zZXN0VG9wTGV2ZWxEb21haW4gIT0gZW1haWxQYXJ0cy50b3BMZXZlbERvbWFpbiAmJiBlbWFpbFBhcnRzLnNlY29uZExldmVsRG9tYWluICE9PSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZW1haWwgYWRkcmVzcyBtYXkgaGF2ZSBhIG1pc3BlbGxlZCB0b3AtbGV2ZWwgZG9tYWluOyByZXR1cm4gYSBzdWdnZXN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3Nlc3REb21haW4gPSBjbG9zZXN0RG9tYWluLnJlcGxhY2UobmV3IFJlZ0V4cChlbWFpbFBhcnRzLnRvcExldmVsRG9tYWluICsgXCIkXCIpLCBjbG9zZXN0VG9wTGV2ZWxEb21haW4pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBydHJuID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChydHJuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7IGFkZHJlc3M6IGVtYWlsUGFydHMuYWRkcmVzcywgZG9tYWluOiBjbG9zZXN0RG9tYWluLCBmdWxsOiBlbWFpbFBhcnRzLmFkZHJlc3MgKyBcIkBcIiArIGNsb3Nlc3REb21haW4gfTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLyogVGhlIGVtYWlsIGFkZHJlc3MgZXhhY3RseSBtYXRjaGVzIG9uZSBvZiB0aGUgc3VwcGxpZWQgZG9tYWlucywgZG9lcyBub3QgY2xvc2VseVxyXG4gICAgICAgICAgICAgICAgICogbWF0Y2ggYW55IGRvbWFpbiBhbmQgZG9lcyBub3QgYXBwZWFyIHRvIHNpbXBseSBoYXZlIGEgbWlzcGVsbGVkIHRvcC1sZXZlbCBkb21haW4sXHJcbiAgICAgICAgICAgICAgICAgKiBvciBpcyBhbiBpbnZhbGlkIGVtYWlsIGFkZHJlc3M7IGRvIG5vdCByZXR1cm4gYSBzdWdnZXN0aW9uLlxyXG4gICAgICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICBmaW5kQ2xvc2VzdERvbWFpbjogZnVuY3Rpb24gKGRvbWFpbiwgZG9tYWlucywgZGlzdGFuY2VGdW5jdGlvbiwgdGhyZXNob2xkKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJlc2hvbGQgPSB0aHJlc2hvbGQgfHwgdGhpcy50b3BMZXZlbFRocmVzaG9sZDtcclxuICAgICAgICAgICAgICAgIHZhciBkaXN0O1xyXG4gICAgICAgICAgICAgICAgdmFyIG1pbkRpc3QgPSBJbmZpbml0eTtcclxuICAgICAgICAgICAgICAgIHZhciBjbG9zZXN0RG9tYWluID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIWRvbWFpbiB8fCAhZG9tYWlucykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghZGlzdGFuY2VGdW5jdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlRnVuY3Rpb24gPSB0aGlzLnNpZnQ0RGlzdGFuY2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkb21haW5zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRvbWFpbiA9PT0gZG9tYWluc1tpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZG9tYWluO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBkaXN0ID0gZGlzdGFuY2VGdW5jdGlvbihkb21haW4sIGRvbWFpbnNbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChkaXN0IDwgbWluRGlzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtaW5EaXN0ID0gZGlzdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VzdERvbWFpbiA9IGRvbWFpbnNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChtaW5EaXN0IDw9IHRocmVzaG9sZCAmJiBjbG9zZXN0RG9tYWluICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNsb3Nlc3REb21haW47XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgIHNpZnQ0RGlzdGFuY2U6IGZ1bmN0aW9uIChzMSwgczIsIG1heE9mZnNldCkge1xyXG4gICAgICAgICAgICAgICAgLy8gc2lmdDQ6IGh0dHBzOi8vc2lkZXJpdGUuYmxvZ3Nwb3QuY29tLzIwMTQvMTEvc3VwZXItZmFzdC1hbmQtYWNjdXJhdGUtc3RyaW5nLWRpc3RhbmNlLmh0bWxcclxuICAgICAgICAgICAgICAgIGlmIChtYXhPZmZzZXQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1heE9mZnNldCA9IDU7IC8vZGVmYXVsdFxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICghczEgfHwgIXMxLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghczIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzMi5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFzMiB8fCAhczIubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHMxLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgbDEgPSBzMS5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICB2YXIgbDIgPSBzMi5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGMxID0gMDsgIC8vY3Vyc29yIGZvciBzdHJpbmcgMVxyXG4gICAgICAgICAgICAgICAgdmFyIGMyID0gMDsgIC8vY3Vyc29yIGZvciBzdHJpbmcgMlxyXG4gICAgICAgICAgICAgICAgdmFyIGxjc3MgPSAwOyAgLy9sYXJnZXN0IGNvbW1vbiBzdWJzZXF1ZW5jZVxyXG4gICAgICAgICAgICAgICAgdmFyIGxvY2FsX2NzID0gMDsgLy9sb2NhbCBjb21tb24gc3Vic3RyaW5nXHJcbiAgICAgICAgICAgICAgICB2YXIgdHJhbnMgPSAwOyAgLy9udW1iZXIgb2YgdHJhbnNwb3NpdGlvbnMgKCdhYicgdnMgJ2JhJylcclxuICAgICAgICAgICAgICAgIHZhciBvZmZzZXRfYXJyID0gW107ICAvL29mZnNldCBwYWlyIGFycmF5LCBmb3IgY29tcHV0aW5nIHRoZSB0cmFuc3Bvc2l0aW9uc1xyXG5cclxuICAgICAgICAgICAgICAgIHdoaWxlICgoYzEgPCBsMSkgJiYgKGMyIDwgbDIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHMxLmNoYXJBdChjMSkgPT0gczIuY2hhckF0KGMyKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9jcysrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXNUcmFucyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3NlZSBpZiBjdXJyZW50IG1hdGNoIGlzIGEgdHJhbnNwb3NpdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChpIDwgb2Zmc2V0X2Fyci5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvZnMgPSBvZmZzZXRfYXJyW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMxIDw9IG9mcy5jMSB8fCBjMiA8PSBvZnMuYzIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3aGVuIHR3byBtYXRjaGVzIGNyb3NzLCB0aGUgb25lIGNvbnNpZGVyZWQgYSB0cmFuc3Bvc2l0aW9uIGlzIHRoZSBvbmUgd2l0aCB0aGUgbGFyZ2VzdCBkaWZmZXJlbmNlIGluIG9mZnNldHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1RyYW5zID0gTWF0aC5hYnMoYzIgLSBjMSkgPj0gTWF0aC5hYnMob2ZzLmMyIC0gb2ZzLmMxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNUcmFucykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFucysrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghb2ZzLnRyYW5zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZnMudHJhbnMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnMrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMxID4gb2ZzLmMyICYmIGMyID4gb2ZzLmMxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldF9hcnIuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0X2Fyci5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMxOiBjMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMyOiBjMixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zOiBpc1RyYW5zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxjc3MgKz0gbG9jYWxfY3M7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsX2NzID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMxICE9IGMyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjMSA9IGMyID0gTWF0aC5taW4oYzEsIGMyKTsgIC8vdXNpbmcgbWluIGFsbG93cyB0aGUgY29tcHV0YXRpb24gb2YgdHJhbnNwb3NpdGlvbnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2lmIG1hdGNoaW5nIGNoYXJhY3RlcnMgYXJlIGZvdW5kLCByZW1vdmUgMSBmcm9tIGJvdGggY3Vyc29ycyAodGhleSBnZXQgaW5jcmVtZW50ZWQgYXQgdGhlIGVuZCBvZiB0aGUgbG9vcClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9zbyB0aGF0IHdlIGNhbiBoYXZlIG9ubHkgb25lIGNvZGUgYmxvY2sgaGFuZGxpbmcgbWF0Y2hlcyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBtYXhPZmZzZXQgJiYgKGMxICsgaiA8IGwxIHx8IGMyICsgaiA8IGwyKTsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGMxICsgaiA8IGwxKSAmJiAoczEuY2hhckF0KGMxICsgaikgPT0gczIuY2hhckF0KGMyKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjMSArPSBqIC0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjMi0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChjMiArIGogPCBsMikgJiYgKHMxLmNoYXJBdChjMSkgPT0gczIuY2hhckF0KGMyICsgaikpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYzEtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjMiArPSBqIC0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjMSsrO1xyXG4gICAgICAgICAgICAgICAgICAgIGMyKys7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcyBjb3ZlcnMgdGhlIGNhc2Ugd2hlcmUgdGhlIGxhc3QgbWF0Y2ggaXMgb24gdGhlIGxhc3QgdG9rZW4gaW4gbGlzdCwgc28gdGhhdCBpdCBjYW4gY29tcHV0ZSB0cmFuc3Bvc2l0aW9ucyBjb3JyZWN0bHlcclxuICAgICAgICAgICAgICAgICAgICBpZiAoKGMxID49IGwxKSB8fCAoYzIgPj0gbDIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxjc3MgKz0gbG9jYWxfY3M7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsX2NzID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYzEgPSBjMiA9IE1hdGgubWluKGMxLCBjMik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbGNzcyArPSBsb2NhbF9jcztcclxuICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKE1hdGgubWF4KGwxLCBsMikgLSBsY3NzICsgdHJhbnMpOyAvL2FkZCB0aGUgY29zdCBvZiB0cmFuc3Bvc2l0aW9ucyB0byB0aGUgZmluYWwgcmVzdWx0XHJcbiAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICBzcGxpdEVtYWlsOiBmdW5jdGlvbiAoZW1haWwpIHtcclxuICAgICAgICAgICAgICAgIGVtYWlsID0gZW1haWwgIT09IG51bGwgPyAoZW1haWwucmVwbGFjZSgvXlxccyovLCAnJykucmVwbGFjZSgvXFxzKiQvLCAnJykpIDogbnVsbDsgLy8gdHJpbSgpIG5vdCBleGlzdCBpbiBvbGQgSUUhXHJcbiAgICAgICAgICAgICAgICB2YXIgcGFydHMgPSBlbWFpbC5zcGxpdCgnQCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPCAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocGFydHNbaV0gPT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGRvbWFpbiA9IHBhcnRzLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRvbWFpblBhcnRzID0gZG9tYWluLnNwbGl0KCcuJyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2xkID0gJyc7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGxkID0gJyc7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGRvbWFpblBhcnRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSBhZGRyZXNzIGRvZXMgbm90IGhhdmUgYSB0b3AtbGV2ZWwgZG9tYWluXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkb21haW5QYXJ0cy5sZW5ndGggPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSBhZGRyZXNzIGhhcyBvbmx5IGEgdG9wLWxldmVsIGRvbWFpbiAodmFsaWQgdW5kZXIgUkZDKVxyXG4gICAgICAgICAgICAgICAgICAgIHRsZCA9IGRvbWFpblBhcnRzWzBdO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgYWRkcmVzcyBoYXMgYSBkb21haW4gYW5kIGEgdG9wLWxldmVsIGRvbWFpblxyXG4gICAgICAgICAgICAgICAgICAgIHNsZCA9IGRvbWFpblBhcnRzWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAxOyBqIDwgZG9tYWluUGFydHMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGxkICs9IGRvbWFpblBhcnRzW2pdICsgJy4nO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0bGQgPSB0bGQuc3Vic3RyaW5nKDAsIHRsZC5sZW5ndGggLSAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRvcExldmVsRG9tYWluOiB0bGQsXHJcbiAgICAgICAgICAgICAgICAgICAgc2Vjb25kTGV2ZWxEb21haW46IHNsZCxcclxuICAgICAgICAgICAgICAgICAgICBkb21haW46IGRvbWFpbixcclxuICAgICAgICAgICAgICAgICAgICBhZGRyZXNzOiBwYXJ0cy5qb2luKCdAJylcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICAvLyBFbmNvZGUgdGhlIGVtYWlsIGFkZHJlc3MgdG8gcHJldmVudCBYU1MgYnV0IGxlYXZlIGluIHZhbGlkXHJcbiAgICAgICAgICAgIC8vIGNoYXJhY3RlcnMsIGZvbGxvd2luZyB0aGlzIG9mZmljaWFsIHNwZWM6XHJcbiAgICAgICAgICAgIC8vIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRW1haWxfYWRkcmVzcyNTeW50YXhcclxuICAgICAgICAgICAgZW5jb2RlRW1haWw6IGZ1bmN0aW9uIChlbWFpbCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGVuY29kZVVSSShlbWFpbCk7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSByZXN1bHQucmVwbGFjZSgnJTIwJywgJyAnKS5yZXBsYWNlKCclMjUnLCAnJScpLnJlcGxhY2UoJyU1RScsICdeJylcclxuICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgnJTYwJywgJ2AnKS5yZXBsYWNlKCclN0InLCAneycpLnJlcGxhY2UoJyU3QycsICd8JylcclxuICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgnJTdEJywgJ30nKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBNYWlsY2hlY2s7XHJcbiAgICB9XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ25nTWFpbGNoZWNrJylcclxuICAgICAgICAuZmFjdG9yeSgnbWFpbGNoZWNrRmFjdG9yeScsIG1haWxjaGVja0ZhY3RvcnkpO1xyXG5cclxufSAoKSk7Il19

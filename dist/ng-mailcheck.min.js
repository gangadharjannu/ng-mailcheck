!function(){function e(e,n,o){var t={restrict:"A",require:["?ngModel","?mailcheck"],scope:{},bindToController:{options:"="},controller:function(){},controllerAs:"MC",link:function(n,t,a,i){function l(e,n){var o;for(o in n)n.hasOwnProperty(o)&&e[o]&&e[o].length&&(e[o]=n[o].concat(e[o]));return e}var r,s=i[0],c=i[1],m=null,u=c.options.templateStr||'<p ng-show="MC.suggestion.domain">Did you mean <b ng-click="MC.correctMe(MC.suggestion.full)"><i ng-bind="MC.suggestion.full"></i></b>?</p>',d={templateStr:u,replaceOptions:!0},h=angular.extend({},d,c.options);h.replaceOptions||(r={domains:o.defaultDomains,secondLevelDomains:o.defaultSecondLevelDomains,topLevelDomains:o.defaultTopLevelDomains},h=angular.extend({},d,l(c.options,r))),c.suggestion=!1,t.after(e(h.templateStr)(n)),t.on("blur",function(){h.email=s.$viewValue,c.suggestion=!1,m=o.run(h),n.$evalAsync(function(){c.suggestion=m})}),c.correctMe=function(e){s.$setViewValue(e),s.$render(),n.$evalAsync(function(){c.suggestion.domain=null})}}};return t}e.$inject=["$compile","$timeout","mailcheckFactory"],angular.module("ngMailcheck",[]).directive("mailcheck",e)}()(function(){function e(){var e={domainThreshold:2,secondLevelThreshold:2,topLevelThreshold:2,defaultDomains:["msn.com","bellsouth.net","telus.net","comcast.net","optusnet.com.au","earthlink.net","qq.com","sky.com","icloud.com","mac.com","sympatico.ca","googlemail.com","att.net","xtra.co.nz","web.de","cox.net","gmail.com","ymail.com","aim.com","rogers.com","verizon.net","rocketmail.com","google.com","optonline.net","sbcglobal.net","aol.com","me.com","btinternet.com","charter.net","shaw.ca"],defaultSecondLevelDomains:["yahoo","hotmail","mail","live","outlook","gmx"],defaultTopLevelDomains:["com","com.au","com.tw","ca","co.nz","co.uk","de","fr","it","ru","net","org","edu","gov","jp","nl","kr","se","eu","ie","co.il","us","at","be","dk","hk","es","gr","ch","no","cz","in","net","net.au","info","biz","mil","co.jp","sg","hu","uk"],run:function(n){n.domains=n.domains||e.defaultDomains,n.secondLevelDomains=n.secondLevelDomains||e.defaultSecondLevelDomains,n.topLevelDomains=n.topLevelDomains||e.defaultTopLevelDomains,n.distanceFunction=n.distanceFunction||e.sift4Distance;var o=function(e){return e},t=(n.suggested||o,n.empty||o,e.suggest(e.encodeEmail(n.email),n.domains,n.secondLevelDomains,n.topLevelDomains,n.distanceFunction));return t},suggest:function(e,n,o,t,a){e=e.toLowerCase();var i=this.splitEmail(e);if(o&&t&&o.indexOf(i.secondLevelDomain)!==-1&&t.indexOf(i.topLevelDomain)!==-1)return!1;var l=this.findClosestDomain(i.domain,n,a,this.domainThreshold);if(l)return l!=i.domain&&{address:i.address,domain:l,full:i.address+"@"+l};var r=this.findClosestDomain(i.secondLevelDomain,o,a,this.secondLevelThreshold),s=this.findClosestDomain(i.topLevelDomain,t,a,this.topLevelThreshold);if(i.domain){l=i.domain;var c=!1;if(r&&r!=i.secondLevelDomain&&(l=l.replace(i.secondLevelDomain,r),c=!0),s&&s!=i.topLevelDomain&&""!==i.secondLevelDomain&&(l=l.replace(new RegExp(i.topLevelDomain+"$"),s),c=!0),c)return{address:i.address,domain:l,full:i.address+"@"+l}}return!1},findClosestDomain:function(e,n,o,t){t=t||this.topLevelThreshold;var a,i=1/0,l=null;if(!e||!n)return!1;o||(o=this.sift4Distance);for(var r=0;r<n.length;r++){if(e===n[r])return e;a=o(e,n[r]),a<i&&(i=a,l=n[r])}return i<=t&&null!==l&&l},sift4Distance:function(e,n,o){if(void 0===o&&(o=5),!e||!e.length)return n?n.length:0;if(!n||!n.length)return e.length;for(var t=e.length,a=n.length,i=0,l=0,r=0,s=0,c=0,m=[];i<t&&l<a;){if(e.charAt(i)==n.charAt(l)){s++;for(var u=!1,d=0;d<m.length;){var h=m[d];if(i<=h.c1||l<=h.c2){u=Math.abs(l-i)>=Math.abs(h.c2-h.c1),u?c++:h.trans||(h.trans=!0,c++);break}i>h.c2&&l>h.c1?m.splice(d,1):d++}m.push({c1:i,c2:l,trans:u})}else{r+=s,s=0,i!=l&&(i=l=Math.min(i,l));for(var f=0;f<o&&(i+f<t||l+f<a);f++){if(i+f<t&&e.charAt(i+f)==n.charAt(l)){i+=f-1,l--;break}if(l+f<a&&e.charAt(i)==n.charAt(l+f)){i--,l+=f-1;break}}}i++,l++,(i>=t||l>=a)&&(r+=s,s=0,i=l=Math.min(i,l))}return r+=s,Math.round(Math.max(t,a)-r+c)},splitEmail:function(e){e=null!==e?e.replace(/^\s*/,"").replace(/\s*$/,""):null;var n=e.split("@");if(n.length<2)return!1;for(var o=0;o<n.length;o++)if(""===n[o])return!1;var t=n.pop(),a=t.split("."),i="",l="";if(0===a.length)return!1;if(1==a.length)l=a[0];else{i=a[0];for(var r=1;r<a.length;r++)l+=a[r]+".";l=l.substring(0,l.length-1)}return{topLevelDomain:l,secondLevelDomain:i,domain:t,address:n.join("@")}},encodeEmail:function(e){var n=encodeURI(e);return n=n.replace("%20"," ").replace("%25","%").replace("%5E","^").replace("%60","`").replace("%7B","{").replace("%7C","|").replace("%7D","}")}};return e}e.$inject=[],angular.module("ngMailcheck").factory("mailcheckFactory",e)}());
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haWxjaGVjay5kaXJlY3RpdmUuanMiLCJtYWlsY2hlY2suZmFjdG9yeS5qcyJdLCJuYW1lcyI6WyJtYWlsY2hlY2siLCIkY29tcGlsZSIsIiR0aW1lb3V0IiwibWFpbGNoZWNrRmFjdG9yeSIsIkRETyIsInJlc3RyaWN0IiwicmVxdWlyZSIsInNjb3BlIiwiYmluZFRvQ29udHJvbGxlciIsIm9wdGlvbnMiLCJjb250cm9sbGVyIiwiY29udHJvbGxlckFzIiwibGluayIsImVsZW1lbnQiLCJhdHRycyIsImN0cmxzIiwiY29uY2F0T3B0aW9ucyIsImRlc3QiLCJzcmMiLCJvcHRpb24iLCJoYXNPd25Qcm9wZXJ0eSIsImxlbmd0aCIsImNvbmNhdCIsIm1haWxjaGVja0RlZmF1bHRPcHRpb25zIiwibmdNb2RlbEN0cmwiLCJNQyIsInJlc3VsdCIsInRlbXBsYXRlU3RyIiwiZGVmYXVsdE9wdGlvbnMiLCJyZXBsYWNlT3B0aW9ucyIsImFuZ3VsYXIiLCJleHRlbmQiLCJkb21haW5zIiwiZGVmYXVsdERvbWFpbnMiLCJzZWNvbmRMZXZlbERvbWFpbnMiLCJkZWZhdWx0U2Vjb25kTGV2ZWxEb21haW5zIiwidG9wTGV2ZWxEb21haW5zIiwiZGVmYXVsdFRvcExldmVsRG9tYWlucyIsInN1Z2dlc3Rpb24iLCJhZnRlciIsIm9uIiwiZW1haWwiLCIkdmlld1ZhbHVlIiwicnVuIiwiJGV2YWxBc3luYyIsImNvcnJlY3RNZSIsInZhbCIsIiRzZXRWaWV3VmFsdWUiLCIkcmVuZGVyIiwiZG9tYWluIiwiJGluamVjdCIsIm1vZHVsZSIsImRpcmVjdGl2ZSIsIk1haWxjaGVjayIsImRvbWFpblRocmVzaG9sZCIsInNlY29uZExldmVsVGhyZXNob2xkIiwidG9wTGV2ZWxUaHJlc2hvbGQiLCJvcHRzIiwiZGlzdGFuY2VGdW5jdGlvbiIsInNpZnQ0RGlzdGFuY2UiLCJkZWZhdWx0Q2FsbGJhY2siLCJzdWdnZXN0ZWQiLCJlbXB0eSIsInN1Z2dlc3QiLCJlbmNvZGVFbWFpbCIsInRvTG93ZXJDYXNlIiwiZW1haWxQYXJ0cyIsInRoaXMiLCJzcGxpdEVtYWlsIiwiaW5kZXhPZiIsInNlY29uZExldmVsRG9tYWluIiwidG9wTGV2ZWxEb21haW4iLCJjbG9zZXN0RG9tYWluIiwiZmluZENsb3Nlc3REb21haW4iLCJhZGRyZXNzIiwiZnVsbCIsImNsb3Nlc3RTZWNvbmRMZXZlbERvbWFpbiIsImNsb3Nlc3RUb3BMZXZlbERvbWFpbiIsInJ0cm4iLCJyZXBsYWNlIiwiUmVnRXhwIiwidGhyZXNob2xkIiwiZGlzdCIsIm1pbkRpc3QiLCJJbmZpbml0eSIsImkiLCJzMSIsInMyIiwibWF4T2Zmc2V0IiwidW5kZWZpbmVkIiwibDEiLCJsMiIsImMxIiwiYzIiLCJsY3NzIiwibG9jYWxfY3MiLCJ0cmFucyIsIm9mZnNldF9hcnIiLCJjaGFyQXQiLCJpc1RyYW5zIiwib2ZzIiwiTWF0aCIsImFicyIsInNwbGljZSIsInB1c2giLCJtaW4iLCJqIiwicm91bmQiLCJtYXgiLCJwYXJ0cyIsInNwbGl0IiwicG9wIiwiZG9tYWluUGFydHMiLCJzbGQiLCJ0bGQiLCJzdWJzdHJpbmciLCJqb2luIiwiZW5jb2RlVVJJIiwiZmFjdG9yeSJdLCJtYXBwaW5ncyI6IkNBQ0EsV0FFQSxRQUFBQSxHQUFBQyxFQUFBQyxFQUFBQyxHQUNBLEdBQUFDLElBQ0FDLFNBQUEsSUFDQUMsU0FBQSxXQUFBLGNBQ0FDLFNBQ0FDLGtCQUNBQyxRQUFBLEtBRUFDLFdBQUEsYUFDQUMsYUFBQSxLQUNBQyxLQUFBLFNBQUFMLEVBQUFNLEVBQUFDLEVBQUFDLEdBa0RBLFFBQUFDLEdBQUFDLEVBQUFDLEdBQ0EsR0FBQUMsRUFDQSxLQUFBQSxJQUFBRCxHQUNBQSxFQUFBRSxlQUFBRCxJQUNBRixFQUFBRSxJQUFBRixFQUFBRSxHQUFBRSxTQUNBSixFQUFBRSxHQUFBRCxFQUFBQyxHQUFBRyxPQUFBTCxFQUFBRSxJQUlBLE9BQUFGLEdBekRBLEdBU0FNLEdBVEFDLEVBQUFULEVBQUEsR0FDQVUsRUFBQVYsRUFBQSxHQUNBVyxF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QUFBQSxRQUFBLE1BQUEsS0FBQUEsUUFBQSxNQUFBLEtBQ0FBLFFBQUEsTUFBQSxLQUFBQSxRQUFBLE1BQUEsS0FBQUEsUUFBQSxNQUFBLEtBQ0FBLFFBQUEsTUFBQSxNQUlBLE9BQUExQixHQW5SQWxELEVBQUErQyxXQXNSQXBCLFFBQ0FxQixPQUFBLGVBQ0FtRSxRQUFBLG1CQUFBbkgiLCJmaWxlIjoibmctbWFpbGNoZWNrLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBtYWlsY2hlY2suJGluamVjdCA9IFsnJGNvbXBpbGUnLCAnJHRpbWVvdXQnLCAnbWFpbGNoZWNrRmFjdG9yeSddO1xyXG4gICAgZnVuY3Rpb24gbWFpbGNoZWNrKCRjb21waWxlLCAkdGltZW91dCwgbWFpbGNoZWNrRmFjdG9yeSkge1xyXG4gICAgICAgIHZhciBERE8gPSB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6IFsnP25nTW9kZWwnLCAnP21haWxjaGVjayddLFxyXG4gICAgICAgICAgICBzY29wZToge30sXHJcbiAgICAgICAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnM6ICc9J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbiAoKSB7IH0sXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ01DJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycywgY3RybHMpIHtcclxuICAgICAgICAgICAgICAgIC8vIG5nTW9kZWwgaXMgYW4gYXJyYXkgWzBdIGNvbnRhaW5zIG5nTW9kZWwgWzFdIGNvbnRhaW5zIGRpcmVjdGl2ZSdzIGNvbnRyb2xsZXJcclxuICAgICAgICAgICAgICAgIHZhciBuZ01vZGVsQ3RybCA9IGN0cmxzWzBdLFxyXG4gICAgICAgICAgICAgICAgICAgIE1DID0gY3RybHNbMV0sXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVN0ciA9IE1DLm9wdGlvbnMudGVtcGxhdGVTdHIgfHwgJzxwIG5nLXNob3c9XCJNQy5zdWdnZXN0aW9uLmRvbWFpblwiPkRpZCB5b3UgbWVhbiA8YiBuZy1jbGljaz1cIk1DLmNvcnJlY3RNZShNQy5zdWdnZXN0aW9uLmZ1bGwpXCI+PGkgbmctYmluZD1cIk1DLnN1Z2dlc3Rpb24uZnVsbFwiPjwvaT48L2I+PzwvcD4nLFxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHRPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVN0cjogdGVtcGxhdGVTdHIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2VPcHRpb25zOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gYW5ndWxhci5leHRlbmQoe30sIGRlZmF1bHRPcHRpb25zLCBNQy5vcHRpb25zKSxcclxuICAgICAgICAgICAgICAgICAgICBtYWlsY2hlY2tEZWZhdWx0T3B0aW9ucztcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIW9wdGlvbnMucmVwbGFjZU9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBtYWlsY2hlY2tEZWZhdWx0T3B0aW9ucyA9IGFuZ3VsYXIuY29weSh7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIGRvbWFpbnM6IG1haWxjaGVja0ZhY3RvcnkuZGVmYXVsdERvbWFpbnMsXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgIHNlY29uZExldmVsRG9tYWluczogbWFpbGNoZWNrRmFjdG9yeS5kZWZhdWx0U2Vjb25kTGV2ZWxEb21haW5zLFxyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICB0b3BMZXZlbERvbWFpbnM6IG1haWxjaGVja0ZhY3RvcnkuZGVmYXVsdFRvcExldmVsRG9tYWluc1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIG1haWxjaGVja0RlZmF1bHRPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkb21haW5zOiBtYWlsY2hlY2tGYWN0b3J5LmRlZmF1bHREb21haW5zLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWNvbmRMZXZlbERvbWFpbnM6IG1haWxjaGVja0ZhY3RvcnkuZGVmYXVsdFNlY29uZExldmVsRG9tYWlucyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9wTGV2ZWxEb21haW5zOiBtYWlsY2hlY2tGYWN0b3J5LmRlZmF1bHRUb3BMZXZlbERvbWFpbnNcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zID0gYW5ndWxhci5leHRlbmQoe30sIGRlZmF1bHRPcHRpb25zLCBjb25jYXRPcHRpb25zKE1DLm9wdGlvbnMsIG1haWxjaGVja0RlZmF1bHRPcHRpb25zKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvKiBJbXBsZW1lbnRhdGlvbiAqL1xyXG5cclxuICAgICAgICAgICAgICAgIE1DLnN1Z2dlc3Rpb24gPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmFmdGVyKCRjb21waWxlKG9wdGlvbnMudGVtcGxhdGVTdHIpKHNjb3BlKSlcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQub24oJ2JsdXInLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5lbWFpbCA9IG5nTW9kZWxDdHJsLiR2aWV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgTUMuc3VnZ2VzdGlvbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IG1haWxjaGVja0ZhY3RvcnkucnVuKG9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRldmFsQXN5bmMoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBNQy5zdWdnZXN0aW9uID0gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgTUMuY29ycmVjdE1lID0gZnVuY3Rpb24gKHZhbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5nTW9kZWxDdHJsLiRzZXRWaWV3VmFsdWUodmFsKTtcclxuICAgICAgICAgICAgICAgICAgICBuZ01vZGVsQ3RybC4kcmVuZGVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGV2YWxBc3luYyhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE1DLnN1Z2dlc3Rpb24uZG9tYWluID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvKiB1dGlsaXR5IGZ1bmN0aW9uIGZvciBjb25jYXRlbmF0aW5nIHVzZXIgc3BlY2lmaWVkIG9wdGlvbnMgd2l0aCBtYWlsY2hlY2sgZGVmYXVsdCBvcHRpb25zICovXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBjb25jYXRPcHRpb25zKGRlc3QsIHNyYykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvcHRpb247XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChvcHRpb24gaW4gc3JjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzcmMuaGFzT3duUHJvcGVydHkob3B0aW9uKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRlc3Rbb3B0aW9uXSAmJiBkZXN0W29wdGlvbl0ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzdFtvcHRpb25dID0gc3JjW29wdGlvbl0uY29uY2F0KGRlc3Rbb3B0aW9uXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlc3Q7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBERE87XHJcbiAgICB9XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnbmdNYWlsY2hlY2snLCBbXSlcclxuICAgICAgICAuZGlyZWN0aXZlKCdtYWlsY2hlY2snLCBtYWlsY2hlY2spO1xyXG59KCkpIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgIG1haWxjaGVja0ZhY3RvcnkuJGluamVjdCA9IFtdO1xyXG4gICAgZnVuY3Rpb24gbWFpbGNoZWNrRmFjdG9yeSgpIHtcclxuICAgICAgICB2YXIgTWFpbGNoZWNrID0ge1xyXG4gICAgICAgICAgICBkb21haW5UaHJlc2hvbGQ6IDIsXHJcbiAgICAgICAgICAgIHNlY29uZExldmVsVGhyZXNob2xkOiAyLFxyXG4gICAgICAgICAgICB0b3BMZXZlbFRocmVzaG9sZDogMixcclxuXHJcbiAgICAgICAgICAgIGRlZmF1bHREb21haW5zOiBbJ21zbi5jb20nLCAnYmVsbHNvdXRoLm5ldCcsXHJcbiAgICAgICAgICAgICAgICAndGVsdXMubmV0JywgJ2NvbWNhc3QubmV0JywgJ29wdHVzbmV0LmNvbS5hdScsXHJcbiAgICAgICAgICAgICAgICAnZWFydGhsaW5rLm5ldCcsICdxcS5jb20nLCAnc2t5LmNvbScsICdpY2xvdWQuY29tJyxcclxuICAgICAgICAgICAgICAgICdtYWMuY29tJywgJ3N5bXBhdGljby5jYScsICdnb29nbGVtYWlsLmNvbScsXHJcbiAgICAgICAgICAgICAgICAnYXR0Lm5ldCcsICd4dHJhLmNvLm56JywgJ3dlYi5kZScsXHJcbiAgICAgICAgICAgICAgICAnY294Lm5ldCcsICdnbWFpbC5jb20nLCAneW1haWwuY29tJyxcclxuICAgICAgICAgICAgICAgICdhaW0uY29tJywgJ3JvZ2Vycy5jb20nLCAndmVyaXpvbi5uZXQnLFxyXG4gICAgICAgICAgICAgICAgJ3JvY2tldG1haWwuY29tJywgJ2dvb2dsZS5jb20nLCAnb3B0b25saW5lLm5ldCcsXHJcbiAgICAgICAgICAgICAgICAnc2JjZ2xvYmFsLm5ldCcsICdhb2wuY29tJywgJ21lLmNvbScsICdidGludGVybmV0LmNvbScsXHJcbiAgICAgICAgICAgICAgICAnY2hhcnRlci5uZXQnLCAnc2hhdy5jYSddLFxyXG5cclxuICAgICAgICAgICAgZGVmYXVsdFNlY29uZExldmVsRG9tYWluczogW1wieWFob29cIiwgXCJob3RtYWlsXCIsIFwibWFpbFwiLCBcImxpdmVcIiwgXCJvdXRsb29rXCIsIFwiZ214XCJdLFxyXG5cclxuICAgICAgICAgICAgZGVmYXVsdFRvcExldmVsRG9tYWluczogW1wiY29tXCIsIFwiY29tLmF1XCIsIFwiY29tLnR3XCIsIFwiY2FcIiwgXCJjby5uelwiLCBcImNvLnVrXCIsIFwiZGVcIixcclxuICAgICAgICAgICAgICAgIFwiZnJcIiwgXCJpdFwiLCBcInJ1XCIsIFwibmV0XCIsIFwib3JnXCIsIFwiZWR1XCIsIFwiZ292XCIsIFwianBcIiwgXCJubFwiLCBcImtyXCIsIFwic2VcIiwgXCJldVwiLFxyXG4gICAgICAgICAgICAgICAgXCJpZVwiLCBcImNvLmlsXCIsIFwidXNcIiwgXCJhdFwiLCBcImJlXCIsIFwiZGtcIiwgXCJoa1wiLCBcImVzXCIsIFwiZ3JcIiwgXCJjaFwiLCBcIm5vXCIsIFwiY3pcIixcclxuICAgICAgICAgICAgICAgIFwiaW5cIiwgXCJuZXRcIiwgXCJuZXQuYXVcIiwgXCJpbmZvXCIsIFwiYml6XCIsIFwibWlsXCIsIFwiY28uanBcIiwgXCJzZ1wiLCBcImh1XCIsIFwidWtcIl0sXHJcblxyXG4gICAgICAgICAgICBydW46IGZ1bmN0aW9uIChvcHRzKSB7XHJcbiAgICAgICAgICAgICAgICBvcHRzLmRvbWFpbnMgPSBvcHRzLmRvbWFpbnMgfHwgTWFpbGNoZWNrLmRlZmF1bHREb21haW5zO1xyXG4gICAgICAgICAgICAgICAgb3B0cy5zZWNvbmRMZXZlbERvbWFpbnMgPSBvcHRzLnNlY29uZExldmVsRG9tYWlucyB8fCBNYWlsY2hlY2suZGVmYXVsdFNlY29uZExldmVsRG9tYWlucztcclxuICAgICAgICAgICAgICAgIG9wdHMudG9wTGV2ZWxEb21haW5zID0gb3B0cy50b3BMZXZlbERvbWFpbnMgfHwgTWFpbGNoZWNrLmRlZmF1bHRUb3BMZXZlbERvbWFpbnM7XHJcbiAgICAgICAgICAgICAgICBvcHRzLmRpc3RhbmNlRnVuY3Rpb24gPSBvcHRzLmRpc3RhbmNlRnVuY3Rpb24gfHwgTWFpbGNoZWNrLnNpZnQ0RGlzdGFuY2U7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmF1bHRDYWxsYmFjayA9IGZ1bmN0aW9uIChyZXN1bHQpIHsgcmV0dXJuIHJlc3VsdDsgfTtcclxuICAgICAgICAgICAgICAgIHZhciBzdWdnZXN0ZWRDYWxsYmFjayA9IG9wdHMuc3VnZ2VzdGVkIHx8IGRlZmF1bHRDYWxsYmFjaztcclxuICAgICAgICAgICAgICAgIHZhciBlbXB0eUNhbGxiYWNrID0gb3B0cy5lbXB0eSB8fCBkZWZhdWx0Q2FsbGJhY2s7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IE1haWxjaGVjay5zdWdnZXN0KE1haWxjaGVjay5lbmNvZGVFbWFpbChvcHRzLmVtYWlsKSwgb3B0cy5kb21haW5zLCBvcHRzLnNlY29uZExldmVsRG9tYWlucywgb3B0cy50b3BMZXZlbERvbWFpbnMsIG9wdHMuZGlzdGFuY2VGdW5jdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gcmV0dXJuIHJlc3VsdCA/IHN1Z2dlc3RlZENhbGxiYWNrKHJlc3VsdCkgOiBlbXB0eUNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9LFxyXG5cclxuICAgICAgICAgICAgc3VnZ2VzdDogZnVuY3Rpb24gKGVtYWlsLCBkb21haW5zLCBzZWNvbmRMZXZlbERvbWFpbnMsIHRvcExldmVsRG9tYWlucywgZGlzdGFuY2VGdW5jdGlvbikge1xyXG4gICAgICAgICAgICAgICAgZW1haWwgPSBlbWFpbC50b0xvd2VyQ2FzZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBlbWFpbFBhcnRzID0gdGhpcy5zcGxpdEVtYWlsKGVtYWlsKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2Vjb25kTGV2ZWxEb21haW5zICYmIHRvcExldmVsRG9tYWlucykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBlbWFpbCBpcyBhIHZhbGlkIDJuZC1sZXZlbCArIHRvcC1sZXZlbCwgZG8gbm90IHN1Z2dlc3QgYW55dGhpbmcuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlY29uZExldmVsRG9tYWlucy5pbmRleE9mKGVtYWlsUGFydHMuc2Vjb25kTGV2ZWxEb21haW4pICE9PSAtMSAmJiB0b3BMZXZlbERvbWFpbnMuaW5kZXhPZihlbWFpbFBhcnRzLnRvcExldmVsRG9tYWluKSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY2xvc2VzdERvbWFpbiA9IHRoaXMuZmluZENsb3Nlc3REb21haW4oZW1haWxQYXJ0cy5kb21haW4sIGRvbWFpbnMsIGRpc3RhbmNlRnVuY3Rpb24sIHRoaXMuZG9tYWluVGhyZXNob2xkKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoY2xvc2VzdERvbWFpbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjbG9zZXN0RG9tYWluID09IGVtYWlsUGFydHMuZG9tYWluKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBlbWFpbCBhZGRyZXNzIGV4YWN0bHkgbWF0Y2hlcyBvbmUgb2YgdGhlIHN1cHBsaWVkIGRvbWFpbnM7IGRvIG5vdCByZXR1cm4gYSBzdWdnZXN0aW9uLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGVtYWlsIGFkZHJlc3MgY2xvc2VseSBtYXRjaGVzIG9uZSBvZiB0aGUgc3VwcGxpZWQgZG9tYWluczsgcmV0dXJuIGEgc3VnZ2VzdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBhZGRyZXNzOiBlbWFpbFBhcnRzLmFkZHJlc3MsIGRvbWFpbjogY2xvc2VzdERvbWFpbiwgZnVsbDogZW1haWxQYXJ0cy5hZGRyZXNzICsgXCJAXCIgKyBjbG9zZXN0RG9tYWluIH07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIFRoZSBlbWFpbCBhZGRyZXNzIGRvZXMgbm90IGNsb3NlbHkgbWF0Y2ggb25lIG9mIHRoZSBzdXBwbGllZCBkb21haW5zXHJcbiAgICAgICAgICAgICAgICB2YXIgY2xvc2VzdFNlY29uZExldmVsRG9tYWluID0gdGhpcy5maW5kQ2xvc2VzdERvbWFpbihlbWFpbFBhcnRzLnNlY29uZExldmVsRG9tYWluLCBzZWNvbmRMZXZlbERvbWFpbnMsIGRpc3RhbmNlRnVuY3Rpb24sIHRoaXMuc2Vjb25kTGV2ZWxUaHJlc2hvbGQpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNsb3Nlc3RUb3BMZXZlbERvbWFpbiA9IHRoaXMuZmluZENsb3Nlc3REb21haW4oZW1haWxQYXJ0cy50b3BMZXZlbERvbWFpbiwgdG9wTGV2ZWxEb21haW5zLCBkaXN0YW5jZUZ1bmN0aW9uLCB0aGlzLnRvcExldmVsVGhyZXNob2xkKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZW1haWxQYXJ0cy5kb21haW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBjbG9zZXN0RG9tYWluID0gZW1haWxQYXJ0cy5kb21haW47XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJ0cm4gPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNsb3Nlc3RTZWNvbmRMZXZlbERvbWFpbiAmJiBjbG9zZXN0U2Vjb25kTGV2ZWxEb21haW4gIT0gZW1haWxQYXJ0cy5zZWNvbmRMZXZlbERvbWFpbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZW1haWwgYWRkcmVzcyBtYXkgaGF2ZSBhIG1pc3BlbGxlZCBzZWNvbmQtbGV2ZWwgZG9tYWluOyByZXR1cm4gYSBzdWdnZXN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3Nlc3REb21haW4gPSBjbG9zZXN0RG9tYWluLnJlcGxhY2UoZW1haWxQYXJ0cy5zZWNvbmRMZXZlbERvbWFpbiwgY2xvc2VzdFNlY29uZExldmVsRG9tYWluKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcnRybiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2xvc2VzdFRvcExldmVsRG9tYWluICYmIGNsb3Nlc3RUb3BMZXZlbERvbWFpbiAhPSBlbWFpbFBhcnRzLnRvcExldmVsRG9tYWluICYmIGVtYWlsUGFydHMuc2Vjb25kTGV2ZWxEb21haW4gIT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBlbWFpbCBhZGRyZXNzIG1heSBoYXZlIGEgbWlzcGVsbGVkIHRvcC1sZXZlbCBkb21haW47IHJldHVybiBhIHN1Z2dlc3Rpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VzdERvbWFpbiA9IGNsb3Nlc3REb21haW4ucmVwbGFjZShuZXcgUmVnRXhwKGVtYWlsUGFydHMudG9wTGV2ZWxEb21haW4gKyBcIiRcIiksIGNsb3Nlc3RUb3BMZXZlbERvbWFpbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ0cm4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJ0cm4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgYWRkcmVzczogZW1haWxQYXJ0cy5hZGRyZXNzLCBkb21haW46IGNsb3Nlc3REb21haW4sIGZ1bGw6IGVtYWlsUGFydHMuYWRkcmVzcyArIFwiQFwiICsgY2xvc2VzdERvbWFpbiB9O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvKiBUaGUgZW1haWwgYWRkcmVzcyBleGFjdGx5IG1hdGNoZXMgb25lIG9mIHRoZSBzdXBwbGllZCBkb21haW5zLCBkb2VzIG5vdCBjbG9zZWx5XHJcbiAgICAgICAgICAgICAgICAgKiBtYXRjaCBhbnkgZG9tYWluIGFuZCBkb2VzIG5vdCBhcHBlYXIgdG8gc2ltcGx5IGhhdmUgYSBtaXNwZWxsZWQgdG9wLWxldmVsIGRvbWFpbixcclxuICAgICAgICAgICAgICAgICAqIG9yIGlzIGFuIGludmFsaWQgZW1haWwgYWRkcmVzczsgZG8gbm90IHJldHVybiBhIHN1Z2dlc3Rpb24uXHJcbiAgICAgICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgIGZpbmRDbG9zZXN0RG9tYWluOiBmdW5jdGlvbiAoZG9tYWluLCBkb21haW5zLCBkaXN0YW5jZUZ1bmN0aW9uLCB0aHJlc2hvbGQpIHtcclxuICAgICAgICAgICAgICAgIHRocmVzaG9sZCA9IHRocmVzaG9sZCB8fCB0aGlzLnRvcExldmVsVGhyZXNob2xkO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRpc3Q7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWluRGlzdCA9IEluZmluaXR5O1xyXG4gICAgICAgICAgICAgICAgdmFyIGNsb3Nlc3REb21haW4gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghZG9tYWluIHx8ICFkb21haW5zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCFkaXN0YW5jZUZ1bmN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2VGdW5jdGlvbiA9IHRoaXMuc2lmdDREaXN0YW5jZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRvbWFpbnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZG9tYWluID09PSBkb21haW5zW2ldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkb21haW47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGRpc3QgPSBkaXN0YW5jZUZ1bmN0aW9uKGRvbWFpbiwgZG9tYWluc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3QgPCBtaW5EaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbkRpc3QgPSBkaXN0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbG9zZXN0RG9tYWluID0gZG9tYWluc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG1pbkRpc3QgPD0gdGhyZXNob2xkICYmIGNsb3Nlc3REb21haW4gIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2xvc2VzdERvbWFpbjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG5cclxuICAgICAgICAgICAgc2lmdDREaXN0YW5jZTogZnVuY3Rpb24gKHMxLCBzMiwgbWF4T2Zmc2V0KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBzaWZ0NDogaHR0cHM6Ly9zaWRlcml0ZS5ibG9nc3BvdC5jb20vMjAxNC8xMS9zdXBlci1mYXN0LWFuZC1hY2N1cmF0ZS1zdHJpbmctZGlzdGFuY2UuaHRtbFxyXG4gICAgICAgICAgICAgICAgaWYgKG1heE9mZnNldCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWF4T2Zmc2V0ID0gNTsgLy9kZWZhdWx0XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFzMSB8fCAhczEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHMyLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXMyIHx8ICFzMi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gczEubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBsMSA9IHMxLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIHZhciBsMiA9IHMyLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgYzEgPSAwOyAgLy9jdXJzb3IgZm9yIHN0cmluZyAxXHJcbiAgICAgICAgICAgICAgICB2YXIgYzIgPSAwOyAgLy9jdXJzb3IgZm9yIHN0cmluZyAyXHJcbiAgICAgICAgICAgICAgICB2YXIgbGNzcyA9IDA7ICAvL2xhcmdlc3QgY29tbW9uIHN1YnNlcXVlbmNlXHJcbiAgICAgICAgICAgICAgICB2YXIgbG9jYWxfY3MgPSAwOyAvL2xvY2FsIGNvbW1vbiBzdWJzdHJpbmdcclxuICAgICAgICAgICAgICAgIHZhciB0cmFucyA9IDA7ICAvL251bWJlciBvZiB0cmFuc3Bvc2l0aW9ucyAoJ2FiJyB2cyAnYmEnKVxyXG4gICAgICAgICAgICAgICAgdmFyIG9mZnNldF9hcnIgPSBbXTsgIC8vb2Zmc2V0IHBhaXIgYXJyYXksIGZvciBjb21wdXRpbmcgdGhlIHRyYW5zcG9zaXRpb25zXHJcblxyXG4gICAgICAgICAgICAgICAgd2hpbGUgKChjMSA8IGwxKSAmJiAoYzIgPCBsMikpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoczEuY2hhckF0KGMxKSA9PSBzMi5jaGFyQXQoYzIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsX2NzKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpc1RyYW5zID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vc2VlIGlmIGN1cnJlbnQgbWF0Y2ggaXMgYSB0cmFuc3Bvc2l0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGkgPCBvZmZzZXRfYXJyLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9mcyA9IG9mZnNldF9hcnJbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYzEgPD0gb2ZzLmMxIHx8IGMyIDw9IG9mcy5jMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdoZW4gdHdvIG1hdGNoZXMgY3Jvc3MsIHRoZSBvbmUgY29uc2lkZXJlZCBhIHRyYW5zcG9zaXRpb24gaXMgdGhlIG9uZSB3aXRoIHRoZSBsYXJnZXN0IGRpZmZlcmVuY2UgaW4gb2Zmc2V0c1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVHJhbnMgPSBNYXRoLmFicyhjMiAtIGMxKSA+PSBNYXRoLmFicyhvZnMuYzIgLSBvZnMuYzEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc1RyYW5zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFvZnMudHJhbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mcy50cmFucyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFucysrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYzEgPiBvZnMuYzIgJiYgYzIgPiBvZnMuYzEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0X2Fyci5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXRfYXJyLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYzE6IGMxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYzI6IGMyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnM6IGlzVHJhbnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGNzcyArPSBsb2NhbF9jcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfY3MgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYzEgIT0gYzIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMxID0gYzIgPSBNYXRoLm1pbihjMSwgYzIpOyAgLy91c2luZyBtaW4gYWxsb3dzIHRoZSBjb21wdXRhdGlvbiBvZiB0cmFuc3Bvc2l0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgbWF0Y2hpbmcgY2hhcmFjdGVycyBhcmUgZm91bmQsIHJlbW92ZSAxIGZyb20gYm90aCBjdXJzb3JzICh0aGV5IGdldCBpbmNyZW1lbnRlZCBhdCB0aGUgZW5kIG9mIHRoZSBsb29wKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3NvIHRoYXQgd2UgY2FuIGhhdmUgb25seSBvbmUgY29kZSBibG9jayBoYW5kbGluZyBtYXRjaGVzIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1heE9mZnNldCAmJiAoYzEgKyBqIDwgbDEgfHwgYzIgKyBqIDwgbDIpOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoYzEgKyBqIDwgbDEpICYmIChzMS5jaGFyQXQoYzEgKyBqKSA9PSBzMi5jaGFyQXQoYzIpKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMxICs9IGogLSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMyLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGMyICsgaiA8IGwyKSAmJiAoczEuY2hhckF0KGMxKSA9PSBzMi5jaGFyQXQoYzIgKyBqKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjMS0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMyICs9IGogLSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGMxKys7XHJcbiAgICAgICAgICAgICAgICAgICAgYzIrKztcclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGNvdmVycyB0aGUgY2FzZSB3aGVyZSB0aGUgbGFzdCBtYXRjaCBpcyBvbiB0aGUgbGFzdCB0b2tlbiBpbiBsaXN0LCBzbyB0aGF0IGl0IGNhbiBjb21wdXRlIHRyYW5zcG9zaXRpb25zIGNvcnJlY3RseVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICgoYzEgPj0gbDEpIHx8IChjMiA+PSBsMikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGNzcyArPSBsb2NhbF9jcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfY3MgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjMSA9IGMyID0gTWF0aC5taW4oYzEsIGMyKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBsY3NzICs9IGxvY2FsX2NzO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoTWF0aC5tYXgobDEsIGwyKSAtIGxjc3MgKyB0cmFucyk7IC8vYWRkIHRoZSBjb3N0IG9mIHRyYW5zcG9zaXRpb25zIHRvIHRoZSBmaW5hbCByZXN1bHRcclxuICAgICAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgIHNwbGl0RW1haWw6IGZ1bmN0aW9uIChlbWFpbCkge1xyXG4gICAgICAgICAgICAgICAgZW1haWwgPSBlbWFpbCAhPT0gbnVsbCA/IChlbWFpbC5yZXBsYWNlKC9eXFxzKi8sICcnKS5yZXBsYWNlKC9cXHMqJC8sICcnKSkgOiBudWxsOyAvLyB0cmltKCkgbm90IGV4aXN0IGluIG9sZCBJRSFcclxuICAgICAgICAgICAgICAgIHZhciBwYXJ0cyA9IGVtYWlsLnNwbGl0KCdAJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA8IDIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0c1tpXSA9PT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgZG9tYWluID0gcGFydHMucG9wKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZG9tYWluUGFydHMgPSBkb21haW4uc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgICAgIHZhciBzbGQgPSAnJztcclxuICAgICAgICAgICAgICAgIHZhciB0bGQgPSAnJztcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZG9tYWluUGFydHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGFkZHJlc3MgZG9lcyBub3QgaGF2ZSBhIHRvcC1sZXZlbCBkb21haW5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRvbWFpblBhcnRzLmxlbmd0aCA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGFkZHJlc3MgaGFzIG9ubHkgYSB0b3AtbGV2ZWwgZG9tYWluICh2YWxpZCB1bmRlciBSRkMpXHJcbiAgICAgICAgICAgICAgICAgICAgdGxkID0gZG9tYWluUGFydHNbMF07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSBhZGRyZXNzIGhhcyBhIGRvbWFpbiBhbmQgYSB0b3AtbGV2ZWwgZG9tYWluXHJcbiAgICAgICAgICAgICAgICAgICAgc2xkID0gZG9tYWluUGFydHNbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDE7IGogPCBkb21haW5QYXJ0cy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0bGQgKz0gZG9tYWluUGFydHNbal0gKyAnLic7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRsZCA9IHRsZC5zdWJzdHJpbmcoMCwgdGxkLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9wTGV2ZWxEb21haW46IHRsZCxcclxuICAgICAgICAgICAgICAgICAgICBzZWNvbmRMZXZlbERvbWFpbjogc2xkLFxyXG4gICAgICAgICAgICAgICAgICAgIGRvbWFpbjogZG9tYWluLFxyXG4gICAgICAgICAgICAgICAgICAgIGFkZHJlc3M6IHBhcnRzLmpvaW4oJ0AnKVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgIC8vIEVuY29kZSB0aGUgZW1haWwgYWRkcmVzcyB0byBwcmV2ZW50IFhTUyBidXQgbGVhdmUgaW4gdmFsaWRcclxuICAgICAgICAgICAgLy8gY2hhcmFjdGVycywgZm9sbG93aW5nIHRoaXMgb2ZmaWNpYWwgc3BlYzpcclxuICAgICAgICAgICAgLy8gaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9FbWFpbF9hZGRyZXNzI1N5bnRheFxyXG4gICAgICAgICAgICBlbmNvZGVFbWFpbDogZnVuY3Rpb24gKGVtYWlsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gZW5jb2RlVVJJKGVtYWlsKTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKCclMjAnLCAnICcpLnJlcGxhY2UoJyUyNScsICclJykucmVwbGFjZSgnJTVFJywgJ14nKVxyXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCclNjAnLCAnYCcpLnJlcGxhY2UoJyU3QicsICd7JykucmVwbGFjZSgnJTdDJywgJ3wnKVxyXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCclN0QnLCAnfScpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIE1haWxjaGVjaztcclxuICAgIH1cclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnbmdNYWlsY2hlY2snKVxyXG4gICAgICAgIC5mYWN0b3J5KCdtYWlsY2hlY2tGYWN0b3J5JywgbWFpbGNoZWNrRmFjdG9yeSk7XHJcblxyXG59ICgpKTsiXX0=

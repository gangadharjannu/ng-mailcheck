!function(){function e(e,n,o){var t={restrict:"A",require:["?ngModel","?mailcheck"],scope:{},bindToController:{options:"="},controller:function(){},controllerAs:"MC",link:function(n,t,i,a){function l(e,n){var o;for(o in n)n.hasOwnProperty(o)&&e[o]&&e[o].length&&(e[o]=n[o].concat(e[o]));return e}var r=/email|search|text/i;if(!i.ngModel)throw new Error("element must contain ng-model attribute");if("INPUT"!==t[0].nodeName||r.test(i.type))throw new Error("mailcheck element is limited to text, email, search input types only");var s,c=a[0],m=a[1],u=null,d=m.options.templateStr||'<p ng-show="MC.suggestion.domain">Did you mean <b ng-click="MC.correctMe(MC.suggestion.full)"><i ng-bind="MC.suggestion.full"></i></b>?</p>',h={templateStr:d,replaceOptions:!0},f=angular.extend({},h,m.options);f.replaceOptions||(s={domains:o.defaultDomains,secondLevelDomains:o.defaultSecondLevelDomains,topLevelDomains:o.defaultTopLevelDomains},f=angular.extend({},h,l(m.options,s))),m.suggestion=!1,t.after(e(f.templateStr)(n)),t.on("blur",function(){f.email=c.$viewValue,m.suggestion=!1,u=o.run(f),n.$evalAsync(function(){m.suggestion=u})}),m.correctMe=function(e){c.$setViewValue(e),c.$render(),n.$evalAsync(function(){m.suggestion.domain=null})}}};return t}e.$inject=["$compile","$timeout","mailcheckFactory"],angular.module("ngMailcheck",[]).directive("mailcheck",e)}(),function(){function e(){var e={domainThreshold:2,secondLevelThreshold:2,topLevelThreshold:2,defaultDomains:["msn.com","bellsouth.net","telus.net","comcast.net","optusnet.com.au","earthlink.net","qq.com","sky.com","icloud.com","mac.com","sympatico.ca","googlemail.com","att.net","xtra.co.nz","web.de","cox.net","gmail.com","ymail.com","aim.com","rogers.com","verizon.net","rocketmail.com","google.com","optonline.net","sbcglobal.net","aol.com","me.com","btinternet.com","charter.net","shaw.ca"],defaultSecondLevelDomains:["yahoo","hotmail","mail","live","outlook","gmx"],defaultTopLevelDomains:["com","com.au","com.tw","ca","co.nz","co.uk","de","fr","it","ru","net","org","edu","gov","jp","nl","kr","se","eu","ie","co.il","us","at","be","dk","hk","es","gr","ch","no","cz","in","net","net.au","info","biz","mil","co.jp","sg","hu","uk"],run:function(n){n.domains=n.domains||e.defaultDomains,n.secondLevelDomains=n.secondLevelDomains||e.defaultSecondLevelDomains,n.topLevelDomains=n.topLevelDomains||e.defaultTopLevelDomains,n.distanceFunction=n.distanceFunction||e.sift4Distance;var o=function(e){return e},t=(n.suggested||o,n.empty||o,e.suggest(e.encodeEmail(n.email),n.domains,n.secondLevelDomains,n.topLevelDomains,n.distanceFunction));return t},suggest:function(e,n,o,t,i){e=e.toLowerCase();var a=this.splitEmail(e);if(o&&t&&o.indexOf(a.secondLevelDomain)!==-1&&t.indexOf(a.topLevelDomain)!==-1)return!1;var l=this.findClosestDomain(a.domain,n,i,this.domainThreshold);if(l)return l!=a.domain&&{address:a.address,domain:l,full:a.address+"@"+l};var r=this.findClosestDomain(a.secondLevelDomain,o,i,this.secondLevelThreshold),s=this.findClosestDomain(a.topLevelDomain,t,i,this.topLevelThreshold);if(a.domain){l=a.domain;var c=!1;if(r&&r!=a.secondLevelDomain&&(l=l.replace(a.secondLevelDomain,r),c=!0),s&&s!=a.topLevelDomain&&""!==a.secondLevelDomain&&(l=l.replace(new RegExp(a.topLevelDomain+"$"),s),c=!0),c)return{address:a.address,domain:l,full:a.address+"@"+l}}return!1},findClosestDomain:function(e,n,o,t){t=t||this.topLevelThreshold;var i,a=1/0,l=null;if(!e||!n)return!1;o||(o=this.sift4Distance);for(var r=0;r<n.length;r++){if(e===n[r])return e;i=o(e,n[r]),i<a&&(a=i,l=n[r])}return a<=t&&null!==l&&l},sift4Distance:function(e,n,o){if(void 0===o&&(o=5),!e||!e.length)return n?n.length:0;if(!n||!n.length)return e.length;for(var t=e.length,i=n.length,a=0,l=0,r=0,s=0,c=0,m=[];a<t&&l<i;){if(e.charAt(a)==n.charAt(l)){s++;for(var u=!1,d=0;d<m.length;){var h=m[d];if(a<=h.c1||l<=h.c2){u=Math.abs(l-a)>=Math.abs(h.c2-h.c1),u?c++:h.trans||(h.trans=!0,c++);break}a>h.c2&&l>h.c1?m.splice(d,1):d++}m.push({c1:a,c2:l,trans:u})}else{r+=s,s=0,a!=l&&(a=l=Math.min(a,l));for(var f=0;f<o&&(a+f<t||l+f<i);f++){if(a+f<t&&e.charAt(a+f)==n.charAt(l)){a+=f-1,l--;break}if(l+f<i&&e.charAt(a)==n.charAt(l+f)){a--,l+=f-1;break}}}a++,l++,(a>=t||l>=i)&&(r+=s,s=0,a=l=Math.min(a,l))}return r+=s,Math.round(Math.max(t,i)-r+c)},splitEmail:function(e){e=null!==e?e.replace(/^\s*/,"").replace(/\s*$/,""):null;var n=e.split("@");if(n.length<2)return!1;for(var o=0;o<n.length;o++)if(""===n[o])return!1;var t=n.pop(),i=t.split("."),a="",l="";if(0===i.length)return!1;if(1==i.length)l=i[0];else{a=i[0];for(var r=1;r<i.length;r++)l+=i[r]+".";l=l.substring(0,l.length-1)}return{topLevelDomain:l,secondLevelDomain:a,domain:t,address:n.join("@")}},encodeEmail:function(e){var n=encodeURI(e);return n=n.replace("%20"," ").replace("%25","%").replace("%5E","^").replace("%60","`").replace("%7B","{").replace("%7C","|").replace("%7D","}")}};return e}e.$inject=[],angular.module("ngMailcheck").factory("mailcheckFactory",e)}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haWxjaGVjay5kaXJlY3RpdmUuanMiLCJtYWlsY2hlY2suZmFjdG9yeS5qcyJdLCJuYW1lcyI6WyJtYWlsY2hlY2siLCIkY29tcGlsZSIsIiR0aW1lb3V0IiwibWFpbGNoZWNrRmFjdG9yeSIsIkRETyIsInJlc3RyaWN0IiwicmVxdWlyZSIsInNjb3BlIiwiYmluZFRvQ29udHJvbGxlciIsIm9wdGlvbnMiLCJjb250cm9sbGVyIiwiY29udHJvbGxlckFzIiwibGluayIsImVsZW1lbnQiLCJhdHRycyIsImN0cmxzIiwiY29uY2F0T3B0aW9ucyIsImRlc3QiLCJzcmMiLCJvcHRpb24iLCJoYXNPd25Qcm9wZXJ0eSIsImxlbmd0aCIsImNvbmNhdCIsInJlc3RyaWN0ZWRUeXBlcyIsIm5nTW9kZWwiLCJFcnJvciIsIm5vZGVOYW1lIiwidGVzdCIsInR5cGUiLCJtYWlsY2hlY2tEZWZhdWx0T3B0aW9ucyIsIm5nTW9kZWxDdHJsIiwiTUMiLCJyZXN1bHQiLCJ0ZW1wbGF0ZVN0ciIsImRlZmF1bHRPcHRpb25zIiwicmVwbGFjZU9wdGlvbnMiLCJhbmd1bGFyIiwiZXh0ZW5kIiwiZG9tYWlucyIsImRlZmF1bHREb21haW5zIiwic2Vjb25kTGV2ZWxEb21haW5zIiwiZGVmYXVsdFNlY29uZExldmVsRG9tYWlucyIsInRvcExldmVsRG9tYWlucyIsImRlZmF1bHRUb3BMZXZlbERvbWFpbnMiLCJzdWdnZXN0aW9uIiwiYWZ0ZXIiLCJvbiIsImVtYWlsIiwiJHZpZXdWYWx1ZSIsInJ1biIsIiRldmFsQXN5bmMiLCJjb3JyZWN0TWUiLCJ2YWwiLCIkc2V0Vmlld1ZhbHVlIiwiJHJlbmRlciIsImRvbWFpbiIsIiRpbmplY3QiLCJtb2R1bGUiLCJkaXJlY3RpdmUiLCJNYWlsY2hlY2siLCJkb21haW5UaHJlc2hvbGQiLCJzZWNvbmRMZXZlbFRocmVzaG9sZCIsInRvcExldmVsVGhyZXNob2xkIiwib3B0cyIsImRpc3RhbmNlRnVuY3Rpb24iLCJzaWZ0NERpc3RhbmNlIiwiZGVmYXVsdENhbGxiYWNrIiwic3VnZ2VzdGVkIiwiZW1wdHkiLCJzdWdnZXN0IiwiZW5jb2RlRW1haWwiLCJ0b0xvd2VyQ2FzZSIsImVtYWlsUGFydHMiLCJ0aGlzIiwic3BsaXRFbWFpbCIsImluZGV4T2YiLCJzZWNvbmRMZXZlbERvbWFpbiIsInRvcExldmVsRG9tYWluIiwiY2xvc2VzdERvbWFpbiIsImZpbmRDbG9zZXN0RG9tYWluIiwiYWRkcmVzcyIsImZ1bGwiLCJjbG9zZXN0U2Vjb25kTGV2ZWxEb21haW4iLCJjbG9zZXN0VG9wTGV2ZWxEb21haW4iLCJydHJuIiwicmVwbGFjZSIsIlJlZ0V4cCIsInRocmVzaG9sZCIsImRpc3QiLCJtaW5EaXN0IiwiSW5maW5pdHkiLCJpIiwiczEiLCJzMiIsIm1heE9mZnNldCIsInVuZGVmaW5lZCIsImwxIiwibDIiLCJjMSIsImMyIiwibGNzcyIsImxvY2FsX2NzIiwidHJhbnMiLCJvZmZzZXRfYXJyIiwiY2hhckF0IiwiaXNUcmFucyIsIm9mcyIsIk1hdGgiLCJhYnMiLCJzcGxpY2UiLCJwdXNoIiwibWluIiwiaiIsInJvdW5kIiwibWF4IiwicGFydHMiLCJzcGxpdCIsInBvcCIsImRvbWFpblBhcnRzIiwic2xkIiwidGxkIiwic3Vic3RyaW5nIiwiam9pbiIsImVuY29kZVVSSSIsImZhY3RvcnkiXSwibWFwcGluZ3MiOiJDQUFBLFdBRUEsUUFBQUEsR0FBQUMsRUFBQUMsRUFBQUMsR0FDQSxHQUFBQyxJQUNBQyxTQUFBLElBQ0FDLFNBQUEsV0FBQSxjQUNBQyxTQUNBQyxrQkFDQUMsUUFBQSxLQUVBQyxXQUFBLGFBQ0FDLGFBQUEsS0FDQUMsS0FBQSxTQUFBTCxFQUFBTSxFQUFBQyxFQUFBQyxHQXFEQSxRQUFBQyxHQUFBQyxFQUFBQyxHQUNBLEdBQUFDLEVBQ0EsS0FBQUEsSUFBQUQsR0FDQUEsRUFBQUUsZUFBQUQsSUFDQUYsRUFBQUUsSUFBQUYsRUFBQUUsR0FBQUUsU0FDQUosRUFBQUUsR0FBQUQsRUFBQUMsR0FBQUcsT0FBQUwsRUFBQUUsSUFJQSxPQUFBRixHQTdEQSxHQUFBTSxHQUFBLG9CQUNBLEtBQUFULEVBQUFVLFFBQ0EsS0FBQSxJQUFBQyxPQUFBLDBDQUVBLElBQUEsVUFBQVosRUFBQSxHQUFBYSxVQUFBSCxFQUFBSSxLQUFBYixFQUFBYyxNQUNBLEtBQUEsSUFBQUgsT0FBQSx1RUFJQSxJQVNBSSxHQVRBQyxFQUFBZixFQUFBLEdBQ0FnQixFQUFBaEIsRUFBQSxHQUNBaUIsRUFBQSxLQUNBQyxFQUFBRixFQUFBdEIsUUFBQXdCLGFBQUEsOElBQ0FDLEdBQ0FELFlBQUFBLEVBQ0FFLGdCQUFBLEdBRUExQixFQUFBMkIsUUFBQUMsVUFBQUgsRUFBQUgsRUFBQXRCLFFBR0FBLEdBQUEwQixpQkFDQU4sR0FDQVMsUUFBQW5DLEVBQUFvQyxlQUNBQyxtQkFBQXJDLEVBQUFzQywwQkFDQUMsZ0JBQUF2QyxFQUFBd0Msd0JBR0FsQyxFQUFBMkIsUUFBQUMsVUFBQUgsRUFBQWxCLEVBQUFlLEVBQUF0QixRQUFBb0IsS0FJQUUsRUFBQWEsWUFBQSxFQUVBL0IsRUFBQWdDLE1BQUE1QyxFQUFBUSxFQUFBd0IsYUFBQTFCLElBQ0FNLEVBQUFpQyxHQUFBLE9BQUEsV0FDQXJDLEVBQUFzQyxNQUFBakIsRUFBQWtCLFdBQ0FqQixFQUFBYSxZQUFBLEVBQ0FaLEVBQUE3QixFQUFBOEMsSUFBQXhDLEdBQ0FGLEVBQUEyQyxXQUFBLFdBQ0FuQixFQUFBYSxXQUFBWixNQUlBRCxFQUFBb0IsVUFBQSxTQUFBQyxHQUNBdEIsRUFBQXVCLGNBQUFELEdBQ0F0QixFQUFBd0IsVUFDQS9DLEVBQUEyQyxXQUFBLFdBQ0FuQixFQUFBYSxXQUFBVyxPQUFBLFNBa0JBLE9BQUFuRCxHQTdFQUosRUFBQXdELFNBQUEsV0FBQSxXQUFBLG9CQStFQXBCLFFBQ0FxQixPQUFBLGtCQUNBQyxVQUFBLFlBQUExRCxNQ2xGQSxXQUVBLFFBQUFHLEtBQ0EsR0FBQXdELElBQ0FDLGdCQUFBLEVBQ0FDLHFCQUFBLEVBQ0FDLGtCQUFBLEVBRUF2QixnQkFBQSxVQUFBLGdCQUNBLFlBQUEsY0FBQSxrQkFDQSxnQkFBQSxTQUFBLFVBQUEsYUFDQSxVQUFBLGVBQUEsaUJBQ0EsVUFBQSxhQUFBLFNBQ0EsVUFBQSxZQUFBLFlBQ0EsVUFBQSxhQUFBLGNBQ0EsaUJBQUEsYUFBQSxnQkFDQSxnQkFBQSxVQUFBLFNBQUEsaUJBQ0EsY0FBQSxXQUVBRSwyQkFBQSxRQUFBLFVBQUEsT0FBQSxPQUFBLFVBQUEsT0FFQUUsd0JBQUEsTUFBQSxTQUFBLFNBQUEsS0FBQSxRQUFBLFFBQUEsS0FDQSxLQUFBLEtBQUEsS0FBQSxNQUFBLE1BQUEsTUFBQSxNQUFBLEtBQUEsS0FBQSxLQUFBLEtBQUEsS0FDQSxLQUFBLFFBQUEsS0FBQSxLQUFBLEtBQUEsS0FBQSxLQUFBLEtBQUEsS0FBQSxLQUFBLEtBQUEsS0FDQSxLQUFBLE1BQUEsU0FBQSxPQUFBLE1BQUEsTUFBQSxRQUFBLEtBQUEsS0FBQSxNQUVBTSxJQUFBLFNBQUFjLEdBQ0FBLEVBQUF6QixRQUFBeUIsRUFBQXpCLFNBQUFxQixFQUFBcEIsZUFDQXdCLEVBQUF2QixtQkFBQXVCLEVBQUF2QixvQkFBQW1CLEVBQUFsQiwwQkFDQXNCLEVBQUFyQixnQkFBQXFCLEVBQUFyQixpQkFBQWlCLEVBQUFoQix1QkFDQW9CLEVBQUFDLGlCQUFBRCxFQUFBQyxrQkFBQUwsRUFBQU0sYUFFQSxJQUFBQyxHQUFBLFNBQUFsQyxHQUFBLE1BQUFBLElBSUFBLEdBSEErQixFQUFBSSxXQUFBRCxFQUNBSCxFQUFBSyxPQUFBRixFQUVBUCxFQUFBVSxRQUFBVixFQUFBVyxZQUFBUCxFQUFBaEIsT0FBQWdCLEVBQUF6QixRQUFBeUIsRUFBQXZCLG1CQUFBdUIsRUFBQXJCLGdCQUFBcUIsRUFBQUMsa0JBR0EsT0FBQWhDLElBR0FxQyxRQUFBLFNBQUF0QixFQUFBVCxFQUFBRSxFQUFBRSxFQUFBc0IsR0FDQWpCLEVBQUFBLEVBQUF3QixhQUVBLElBQUFDLEdBQUFDLEtBQUFDLFdBQUEzQixFQUVBLElBQUFQLEdBQUFFLEdBRUFGLEVBQUFtQyxRQUFBSCxFQUFBSSxzQkFBQSxHQUFBbEMsRUFBQWlDLFFBQUFILEVBQUFLLG1CQUFBLEVBQ0EsT0FBQSxDQUlBLElBQUFDLEdBQUFMLEtBQUFNLGtCQUFBUCxFQUFBakIsT0FBQWpCLEVBQUEwQixFQUFBUyxLQUFBYixnQkFFQSxJQUFBa0IsRUFDQSxNQUFBQSxJQUFBTixFQUFBakIsU0FLQXlCLFFBQUFSLEVBQUFRLFFBQUF6QixPQUFBdUIsRUFBQUcsS0FBQVQsRUFBQVEsUUFBQSxJQUFBRixFQUtBLElBQUFJLEdBQUFULEtBQUFNLGtCQUFBUCxFQUFBSSxrQkFBQXBDLEVBQUF3QixFQUFBUyxLQUFBWixzQkFDQXNCLEVBQUFWLEtBQUFNLGtCQUFBUCxFQUFBSyxlQUFBbkMsRUFBQXNCLEVBQUFTLEtBQUFYLGtCQUVBLElBQUFVLEVBQUFqQixPQUFBLENBQ0F1QixFQUFBTixFQUFBakIsTUFDQSxJQUFBNkIsSUFBQSxDQWNBLElBWkFGLEdBQUFBLEdBQUFWLEVBQUFJLG9CQUVBRSxFQUFBQSxFQUFBTyxRQUFBYixFQUFBSSxrQkFBQU0sR0FDQUUsR0FBQSxHQUdBRCxHQUFBQSxHQUFBWCxFQUFBSyxnQkFBQSxLQUFBTCxFQUFBSSxvQkFFQUUsRUFBQUEsRUFBQU8sUUFBQSxHQUFBQyxRQUFBZCxFQUFBSyxlQUFBLEtBQUFNLEdBQ0FDLEdBQUEsR0FHQUEsRUFDQSxPQUFBSixRQUFBUixFQUFBUSxRQUFBekIsT0FBQXVCLEVBQUFHLEtBQUFULEVBQUFRLFFBQUEsSUFBQUYsR0FRQSxPQUFBLEdBR0FDLGtCQUFBLFNBQUF4QixFQUFBakIsRUFBQTBCLEVBQUF1QixHQUNBQSxFQUFBQSxHQUFBZCxLQUFBWCxpQkFDQSxJQUFBMEIsR0FDQUMsRUFBQUMsRUFBQUEsRUFDQVosRUFBQSxJQUVBLEtBQUF2QixJQUFBakIsRUFDQSxPQUFBLENBRUEwQixLQUNBQSxFQUFBUyxLQUFBUixjQUdBLEtBQUEsR0FBQTBCLEdBQUEsRUFBQUEsRUFBQXJELEVBQUFqQixPQUFBc0UsSUFBQSxDQUNBLEdBQUFwQyxJQUFBakIsRUFBQXFELEdBQ0EsTUFBQXBDLEVBRUFpQyxHQUFBeEIsRUFBQVQsRUFBQWpCLEVBQUFxRCxJQUNBSCxFQUFBQyxJQUNBQSxFQUFBRCxFQUNBVixFQUFBeEMsRUFBQXFELElBSUEsTUFBQUYsSUFBQUYsR0FBQSxPQUFBVCxHQUNBQSxHQU1BYixjQUFBLFNBQUEyQixFQUFBQyxFQUFBQyxHQU1BLEdBSkFDLFNBQUFELElBQ0FBLEVBQUEsSUFHQUYsSUFBQUEsRUFBQXZFLE9BQ0EsTUFBQXdFLEdBR0FBLEVBQUF4RSxPQUZBLENBS0EsS0FBQXdFLElBQUFBLEVBQUF4RSxPQUNBLE1BQUF1RSxHQUFBdkUsTUFhQSxLQVZBLEdBQUEyRSxHQUFBSixFQUFBdkUsT0FDQTRFLEVBQUFKLEVBQUF4RSxPQUVBNkUsRUFBQSxFQUNBQyxFQUFBLEVBQ0FDLEVBQUEsRUFDQUMsRUFBQSxFQUNBQyxFQUFBLEVBQ0FDLEtBRUFMLEVBQUFGLEdBQUFHLEVBQUFGLEdBQUEsQ0FDQSxHQUFBTCxFQUFBWSxPQUFBTixJQUFBTCxFQUFBVyxPQUFBTCxHQUFBLENBQ0FFLEdBSUEsS0FIQSxHQUFBSSxJQUFBLEVBRUFkLEVBQUEsRUFDQUEsRUFBQVksRUFBQWxGLFFBQUEsQ0FDQSxHQUFBcUYsR0FBQUgsRUFBQVosRUFDQSxJQUFBTyxHQUFBUSxFQUFBUixJQUFBQyxHQUFBTyxFQUFBUCxHQUFBLENBRUFNLEVBQUFFLEtBQUFDLElBQUFULEVBQUFELElBQUFTLEtBQUFDLElBQUFGLEVBQUFQLEdBQUFPLEVBQUFSLElBQ0FPLEVBQ0FILElBRUFJLEVBQUFKLFFBQ0FJLEVBQUFKLE9BQUEsRUFDQUEsSUFHQSxPQUVBSixFQUFBUSxFQUFBUCxJQUFBQSxFQUFBTyxFQUFBUixHQUNBSyxFQUFBTSxPQUFBbEIsRUFBQSxHQUVBQSxJQUlBWSxFQUFBTyxNQUNBWixHQUFBQSxFQUNBQyxHQUFBQSxFQUNBRyxNQUFBRyxRQUVBLENBQ0FMLEdBQUFDLEVBQ0FBLEVBQUEsRUFDQUgsR0FBQUMsSUFDQUQsRUFBQUMsRUFBQVEsS0FBQUksSUFBQWIsRUFBQUMsR0FJQSxLQUFBLEdBQUFhLEdBQUEsRUFBQUEsRUFBQWxCLElBQUFJLEVBQUFjLEVBQUFoQixHQUFBRyxFQUFBYSxFQUFBZixHQUFBZSxJQUFBLENBQ0EsR0FBQWQsRUFBQWMsRUFBQWhCLEdBQUFKLEVBQUFZLE9BQUFOLEVBQUFjLElBQUFuQixFQUFBVyxPQUFBTCxHQUFBLENBQ0FELEdBQUFjLEVBQUEsRUFDQWIsR0FDQSxPQUVBLEdBQUFBLEVBQUFhLEVBQUFmLEdBQUFMLEVBQUFZLE9BQUFOLElBQUFMLEVBQUFXLE9BQUFMLEVBQUFhLEdBQUEsQ0FDQWQsSUFDQUMsR0FBQWEsRUFBQSxDQUNBLFNBSUFkLElBQ0FDLEtBRUFELEdBQUFGLEdBQUFHLEdBQUFGLEtBQ0FHLEdBQUFDLEVBQ0FBLEVBQUEsRUFDQUgsRUFBQUMsRUFBQVEsS0FBQUksSUFBQWIsRUFBQUMsSUFJQSxNQURBQyxJQUFBQyxFQUNBTSxLQUFBTSxNQUFBTixLQUFBTyxJQUFBbEIsRUFBQUMsR0FBQUcsRUFBQUUsSUFHQTVCLFdBQUEsU0FBQTNCLEdBQ0FBLEVBQUEsT0FBQUEsRUFBQUEsRUFBQXNDLFFBQUEsT0FBQSxJQUFBQSxRQUFBLE9BQUEsSUFBQSxJQUNBLElBQUE4QixHQUFBcEUsRUFBQXFFLE1BQUEsSUFFQSxJQUFBRCxFQUFBOUYsT0FBQSxFQUNBLE9BQUEsQ0FHQSxLQUFBLEdBQUFzRSxHQUFBLEVBQUFBLEVBQUF3QixFQUFBOUYsT0FBQXNFLElBQ0EsR0FBQSxLQUFBd0IsRUFBQXhCLEdBQ0EsT0FBQSxDQUlBLElBQUFwQyxHQUFBNEQsRUFBQUUsTUFDQUMsRUFBQS9ELEVBQUE2RCxNQUFBLEtBQ0FHLEVBQUEsR0FDQUMsRUFBQSxFQUVBLElBQUEsSUFBQUYsRUFBQWpHLE9BRUEsT0FBQSxDQUNBLElBQUEsR0FBQWlHLEVBQUFqRyxPQUVBbUcsRUFBQUYsRUFBQSxPQUNBLENBRUFDLEVBQUFELEVBQUEsRUFDQSxLQUFBLEdBQUFOLEdBQUEsRUFBQUEsRUFBQU0sRUFBQWpHLE9BQUEyRixJQUNBUSxHQUFBRixFQUFBTixHQUFBLEdBRUFRLEdBQUFBLEVBQUFDLFVBQUEsRUFBQUQsRUFBQW5HLE9BQUEsR0FHQSxPQUNBd0QsZUFBQTJDLEVBQ0E1QyxrQkFBQTJDLEVBQ0FoRSxPQUFBQSxFQUNBeUIsUUFBQW1DLEVBQUFPLEtBQUEsT0FPQXBELFlBQUEsU0FBQXZCLEdBQ0EsR0FBQWYsR0FBQTJGLFVBQUE1RSxFQUlBLE9BSEFmLEdBQUFBLEVBQUFxRCxRQUFBLE1BQUEsS0FBQUEsUUFBQSxNQUFBLEtBQUFBLFFBQUEsTUFBQSxLQUNBQSxRQUFBLE1BQUEsS0FBQUEsUUFBQSxNQUFBLEtBQUFBLFFBQUEsTUFBQSxLQUNBQSxRQUFBLE1BQUEsTUFJQSxPQUFBMUIsR0FuUkF4RCxFQUFBcUQsV0FzUkFwQixRQUNBcUIsT0FBQSxlQUNBbUUsUUFBQSxtQkFBQXpIIiwiZmlsZSI6Im5nLW1haWxjaGVjay5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XHJcbiAgICBtYWlsY2hlY2suJGluamVjdCA9IFsnJGNvbXBpbGUnLCAnJHRpbWVvdXQnLCAnbWFpbGNoZWNrRmFjdG9yeSddO1xyXG4gICAgZnVuY3Rpb24gbWFpbGNoZWNrKCRjb21waWxlLCAkdGltZW91dCwgbWFpbGNoZWNrRmFjdG9yeSkge1xyXG4gICAgICAgIHZhciBERE8gPSB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6IFsnP25nTW9kZWwnLCAnP21haWxjaGVjayddLFxyXG4gICAgICAgICAgICBzY29wZToge30sXHJcbiAgICAgICAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnM6ICc9J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbiAoKSB7IH0sXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ01DJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycywgY3RybHMpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXN0cmljdGVkVHlwZXMgPSAvZW1haWx8c2VhcmNofHRleHQvaTtcclxuICAgICAgICAgICAgICAgIGlmICghYXR0cnMubmdNb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImVsZW1lbnQgbXVzdCBjb250YWluIG5nLW1vZGVsIGF0dHJpYnV0ZVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50WzBdLm5vZGVOYW1lICE9PSBcIklOUFVUXCIgfHwgcmVzdHJpY3RlZFR5cGVzLnRlc3QoYXR0cnMudHlwZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJtYWlsY2hlY2sgZWxlbWVudCBpcyBsaW1pdGVkIHRvIHRleHQsIGVtYWlsLCBzZWFyY2ggaW5wdXQgdHlwZXMgb25seVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBjdHJscyBpcyBhbiBhcnJheS4gWzBdIGNvbnRhaW5zIG5nTW9kZWwsIFsxXSBjb250YWlucyBkaXJlY3RpdmUncyBjb250cm9sbGVyXHJcbiAgICAgICAgICAgICAgICB2YXIgbmdNb2RlbEN0cmwgPSBjdHJsc1swXSxcclxuICAgICAgICAgICAgICAgICAgICBNQyA9IGN0cmxzWzFdLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVTdHIgPSBNQy5vcHRpb25zLnRlbXBsYXRlU3RyIHx8ICc8cCBuZy1zaG93PVwiTUMuc3VnZ2VzdGlvbi5kb21haW5cIj5EaWQgeW91IG1lYW4gPGIgbmctY2xpY2s9XCJNQy5jb3JyZWN0TWUoTUMuc3VnZ2VzdGlvbi5mdWxsKVwiPjxpIG5nLWJpbmQ9XCJNQy5zdWdnZXN0aW9uLmZ1bGxcIj48L2k+PC9iPj88L3A+JyxcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0T3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVTdHI6IHRlbXBsYXRlU3RyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlT3B0aW9uczogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucyA9IGFuZ3VsYXIuZXh0ZW5kKHt9LCBkZWZhdWx0T3B0aW9ucywgTUMub3B0aW9ucyksXHJcbiAgICAgICAgICAgICAgICAgICAgbWFpbGNoZWNrRGVmYXVsdE9wdGlvbnM7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLnJlcGxhY2VPcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFpbGNoZWNrRGVmYXVsdE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvbWFpbnM6IG1haWxjaGVja0ZhY3RvcnkuZGVmYXVsdERvbWFpbnMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZExldmVsRG9tYWluczogbWFpbGNoZWNrRmFjdG9yeS5kZWZhdWx0U2Vjb25kTGV2ZWxEb21haW5zLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3BMZXZlbERvbWFpbnM6IG1haWxjaGVja0ZhY3RvcnkuZGVmYXVsdFRvcExldmVsRG9tYWluc1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSBhbmd1bGFyLmV4dGVuZCh7fSwgZGVmYXVsdE9wdGlvbnMsIGNvbmNhdE9wdGlvbnMoTUMub3B0aW9ucywgbWFpbGNoZWNrRGVmYXVsdE9wdGlvbnMpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8qIEltcGxlbWVudGF0aW9uICovXHJcblxyXG4gICAgICAgICAgICAgICAgTUMuc3VnZ2VzdGlvbiA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuYWZ0ZXIoJGNvbXBpbGUob3B0aW9ucy50ZW1wbGF0ZVN0cikoc2NvcGUpKVxyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5vbignYmx1cicsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmVtYWlsID0gbmdNb2RlbEN0cmwuJHZpZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBNQy5zdWdnZXN0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gbWFpbGNoZWNrRmFjdG9yeS5ydW4ob3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGV2YWxBc3luYyhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE1DLnN1Z2dlc3Rpb24gPSByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBNQy5jb3JyZWN0TWUgPSBmdW5jdGlvbiAodmFsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmdNb2RlbEN0cmwuJHNldFZpZXdWYWx1ZSh2YWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIG5nTW9kZWxDdHJsLiRyZW5kZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS4kZXZhbEFzeW5jKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgTUMuc3VnZ2VzdGlvbi5kb21haW4gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8qIHV0aWxpdHkgZnVuY3Rpb24gZm9yIGNvbmNhdGVuYXRpbmcgdXNlciBzcGVjaWZpZWQgb3B0aW9ucyB3aXRoIG1haWxjaGVjayBkZWZhdWx0IG9wdGlvbnMgKi9cclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGNvbmNhdE9wdGlvbnMoZGVzdCwgc3JjKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKG9wdGlvbiBpbiBzcmMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNyYy5oYXNPd25Qcm9wZXJ0eShvcHRpb24pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGVzdFtvcHRpb25dICYmIGRlc3Rbb3B0aW9uXS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXN0W29wdGlvbl0gPSBzcmNbb3B0aW9uXS5jb25jYXQoZGVzdFtvcHRpb25dKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVzdDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIERETztcclxuICAgIH1cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCduZ01haWxjaGVjaycsIFtdKVxyXG4gICAgICAgIC5kaXJlY3RpdmUoJ21haWxjaGVjaycsIG1haWxjaGVjayk7XHJcbn0oKSk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgIG1haWxjaGVja0ZhY3RvcnkuJGluamVjdCA9IFtdO1xyXG4gICAgZnVuY3Rpb24gbWFpbGNoZWNrRmFjdG9yeSgpIHtcclxuICAgICAgICB2YXIgTWFpbGNoZWNrID0ge1xyXG4gICAgICAgICAgICBkb21haW5UaHJlc2hvbGQ6IDIsXHJcbiAgICAgICAgICAgIHNlY29uZExldmVsVGhyZXNob2xkOiAyLFxyXG4gICAgICAgICAgICB0b3BMZXZlbFRocmVzaG9sZDogMixcclxuXHJcbiAgICAgICAgICAgIGRlZmF1bHREb21haW5zOiBbJ21zbi5jb20nLCAnYmVsbHNvdXRoLm5ldCcsXHJcbiAgICAgICAgICAgICAgICAndGVsdXMubmV0JywgJ2NvbWNhc3QubmV0JywgJ29wdHVzbmV0LmNvbS5hdScsXHJcbiAgICAgICAgICAgICAgICAnZWFydGhsaW5rLm5ldCcsICdxcS5jb20nLCAnc2t5LmNvbScsICdpY2xvdWQuY29tJyxcclxuICAgICAgICAgICAgICAgICdtYWMuY29tJywgJ3N5bXBhdGljby5jYScsICdnb29nbGVtYWlsLmNvbScsXHJcbiAgICAgICAgICAgICAgICAnYXR0Lm5ldCcsICd4dHJhLmNvLm56JywgJ3dlYi5kZScsXHJcbiAgICAgICAgICAgICAgICAnY294Lm5ldCcsICdnbWFpbC5jb20nLCAneW1haWwuY29tJyxcclxuICAgICAgICAgICAgICAgICdhaW0uY29tJywgJ3JvZ2Vycy5jb20nLCAndmVyaXpvbi5uZXQnLFxyXG4gICAgICAgICAgICAgICAgJ3JvY2tldG1haWwuY29tJywgJ2dvb2dsZS5jb20nLCAnb3B0b25saW5lLm5ldCcsXHJcbiAgICAgICAgICAgICAgICAnc2JjZ2xvYmFsLm5ldCcsICdhb2wuY29tJywgJ21lLmNvbScsICdidGludGVybmV0LmNvbScsXHJcbiAgICAgICAgICAgICAgICAnY2hhcnRlci5uZXQnLCAnc2hhdy5jYSddLFxyXG5cclxuICAgICAgICAgICAgZGVmYXVsdFNlY29uZExldmVsRG9tYWluczogW1wieWFob29cIiwgXCJob3RtYWlsXCIsIFwibWFpbFwiLCBcImxpdmVcIiwgXCJvdXRsb29rXCIsIFwiZ214XCJdLFxyXG5cclxuICAgICAgICAgICAgZGVmYXVsdFRvcExldmVsRG9tYWluczogW1wiY29tXCIsIFwiY29tLmF1XCIsIFwiY29tLnR3XCIsIFwiY2FcIiwgXCJjby5uelwiLCBcImNvLnVrXCIsIFwiZGVcIixcclxuICAgICAgICAgICAgICAgIFwiZnJcIiwgXCJpdFwiLCBcInJ1XCIsIFwibmV0XCIsIFwib3JnXCIsIFwiZWR1XCIsIFwiZ292XCIsIFwianBcIiwgXCJubFwiLCBcImtyXCIsIFwic2VcIiwgXCJldVwiLFxyXG4gICAgICAgICAgICAgICAgXCJpZVwiLCBcImNvLmlsXCIsIFwidXNcIiwgXCJhdFwiLCBcImJlXCIsIFwiZGtcIiwgXCJoa1wiLCBcImVzXCIsIFwiZ3JcIiwgXCJjaFwiLCBcIm5vXCIsIFwiY3pcIixcclxuICAgICAgICAgICAgICAgIFwiaW5cIiwgXCJuZXRcIiwgXCJuZXQuYXVcIiwgXCJpbmZvXCIsIFwiYml6XCIsIFwibWlsXCIsIFwiY28uanBcIiwgXCJzZ1wiLCBcImh1XCIsIFwidWtcIl0sXHJcblxyXG4gICAgICAgICAgICBydW46IGZ1bmN0aW9uIChvcHRzKSB7XHJcbiAgICAgICAgICAgICAgICBvcHRzLmRvbWFpbnMgPSBvcHRzLmRvbWFpbnMgfHwgTWFpbGNoZWNrLmRlZmF1bHREb21haW5zO1xyXG4gICAgICAgICAgICAgICAgb3B0cy5zZWNvbmRMZXZlbERvbWFpbnMgPSBvcHRzLnNlY29uZExldmVsRG9tYWlucyB8fCBNYWlsY2hlY2suZGVmYXVsdFNlY29uZExldmVsRG9tYWlucztcclxuICAgICAgICAgICAgICAgIG9wdHMudG9wTGV2ZWxEb21haW5zID0gb3B0cy50b3BMZXZlbERvbWFpbnMgfHwgTWFpbGNoZWNrLmRlZmF1bHRUb3BMZXZlbERvbWFpbnM7XHJcbiAgICAgICAgICAgICAgICBvcHRzLmRpc3RhbmNlRnVuY3Rpb24gPSBvcHRzLmRpc3RhbmNlRnVuY3Rpb24gfHwgTWFpbGNoZWNrLnNpZnQ0RGlzdGFuY2U7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGRlZmF1bHRDYWxsYmFjayA9IGZ1bmN0aW9uIChyZXN1bHQpIHsgcmV0dXJuIHJlc3VsdDsgfTtcclxuICAgICAgICAgICAgICAgIHZhciBzdWdnZXN0ZWRDYWxsYmFjayA9IG9wdHMuc3VnZ2VzdGVkIHx8IGRlZmF1bHRDYWxsYmFjaztcclxuICAgICAgICAgICAgICAgIHZhciBlbXB0eUNhbGxiYWNrID0gb3B0cy5lbXB0eSB8fCBkZWZhdWx0Q2FsbGJhY2s7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IE1haWxjaGVjay5zdWdnZXN0KE1haWxjaGVjay5lbmNvZGVFbWFpbChvcHRzLmVtYWlsKSwgb3B0cy5kb21haW5zLCBvcHRzLnNlY29uZExldmVsRG9tYWlucywgb3B0cy50b3BMZXZlbERvbWFpbnMsIG9wdHMuZGlzdGFuY2VGdW5jdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gcmV0dXJuIHJlc3VsdCA/IHN1Z2dlc3RlZENhbGxiYWNrKHJlc3VsdCkgOiBlbXB0eUNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9LFxyXG5cclxuICAgICAgICAgICAgc3VnZ2VzdDogZnVuY3Rpb24gKGVtYWlsLCBkb21haW5zLCBzZWNvbmRMZXZlbERvbWFpbnMsIHRvcExldmVsRG9tYWlucywgZGlzdGFuY2VGdW5jdGlvbikge1xyXG4gICAgICAgICAgICAgICAgZW1haWwgPSBlbWFpbC50b0xvd2VyQ2FzZSgpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBlbWFpbFBhcnRzID0gdGhpcy5zcGxpdEVtYWlsKGVtYWlsKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoc2Vjb25kTGV2ZWxEb21haW5zICYmIHRvcExldmVsRG9tYWlucykge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBlbWFpbCBpcyBhIHZhbGlkIDJuZC1sZXZlbCArIHRvcC1sZXZlbCwgZG8gbm90IHN1Z2dlc3QgYW55dGhpbmcuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlY29uZExldmVsRG9tYWlucy5pbmRleE9mKGVtYWlsUGFydHMuc2Vjb25kTGV2ZWxEb21haW4pICE9PSAtMSAmJiB0b3BMZXZlbERvbWFpbnMuaW5kZXhPZihlbWFpbFBhcnRzLnRvcExldmVsRG9tYWluKSAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY2xvc2VzdERvbWFpbiA9IHRoaXMuZmluZENsb3Nlc3REb21haW4oZW1haWxQYXJ0cy5kb21haW4sIGRvbWFpbnMsIGRpc3RhbmNlRnVuY3Rpb24sIHRoaXMuZG9tYWluVGhyZXNob2xkKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoY2xvc2VzdERvbWFpbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjbG9zZXN0RG9tYWluID09IGVtYWlsUGFydHMuZG9tYWluKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBlbWFpbCBhZGRyZXNzIGV4YWN0bHkgbWF0Y2hlcyBvbmUgb2YgdGhlIHN1cHBsaWVkIGRvbWFpbnM7IGRvIG5vdCByZXR1cm4gYSBzdWdnZXN0aW9uLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGVtYWlsIGFkZHJlc3MgY2xvc2VseSBtYXRjaGVzIG9uZSBvZiB0aGUgc3VwcGxpZWQgZG9tYWluczsgcmV0dXJuIGEgc3VnZ2VzdGlvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBhZGRyZXNzOiBlbWFpbFBhcnRzLmFkZHJlc3MsIGRvbWFpbjogY2xvc2VzdERvbWFpbiwgZnVsbDogZW1haWxQYXJ0cy5hZGRyZXNzICsgXCJAXCIgKyBjbG9zZXN0RG9tYWluIH07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIFRoZSBlbWFpbCBhZGRyZXNzIGRvZXMgbm90IGNsb3NlbHkgbWF0Y2ggb25lIG9mIHRoZSBzdXBwbGllZCBkb21haW5zXHJcbiAgICAgICAgICAgICAgICB2YXIgY2xvc2VzdFNlY29uZExldmVsRG9tYWluID0gdGhpcy5maW5kQ2xvc2VzdERvbWFpbihlbWFpbFBhcnRzLnNlY29uZExldmVsRG9tYWluLCBzZWNvbmRMZXZlbERvbWFpbnMsIGRpc3RhbmNlRnVuY3Rpb24sIHRoaXMuc2Vjb25kTGV2ZWxUaHJlc2hvbGQpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNsb3Nlc3RUb3BMZXZlbERvbWFpbiA9IHRoaXMuZmluZENsb3Nlc3REb21haW4oZW1haWxQYXJ0cy50b3BMZXZlbERvbWFpbiwgdG9wTGV2ZWxEb21haW5zLCBkaXN0YW5jZUZ1bmN0aW9uLCB0aGlzLnRvcExldmVsVGhyZXNob2xkKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZW1haWxQYXJ0cy5kb21haW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBjbG9zZXN0RG9tYWluID0gZW1haWxQYXJ0cy5kb21haW47XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJ0cm4gPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNsb3Nlc3RTZWNvbmRMZXZlbERvbWFpbiAmJiBjbG9zZXN0U2Vjb25kTGV2ZWxEb21haW4gIT0gZW1haWxQYXJ0cy5zZWNvbmRMZXZlbERvbWFpbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZW1haWwgYWRkcmVzcyBtYXkgaGF2ZSBhIG1pc3BlbGxlZCBzZWNvbmQtbGV2ZWwgZG9tYWluOyByZXR1cm4gYSBzdWdnZXN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3Nlc3REb21haW4gPSBjbG9zZXN0RG9tYWluLnJlcGxhY2UoZW1haWxQYXJ0cy5zZWNvbmRMZXZlbERvbWFpbiwgY2xvc2VzdFNlY29uZExldmVsRG9tYWluKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcnRybiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2xvc2VzdFRvcExldmVsRG9tYWluICYmIGNsb3Nlc3RUb3BMZXZlbERvbWFpbiAhPSBlbWFpbFBhcnRzLnRvcExldmVsRG9tYWluICYmIGVtYWlsUGFydHMuc2Vjb25kTGV2ZWxEb21haW4gIT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBlbWFpbCBhZGRyZXNzIG1heSBoYXZlIGEgbWlzcGVsbGVkIHRvcC1sZXZlbCBkb21haW47IHJldHVybiBhIHN1Z2dlc3Rpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VzdERvbWFpbiA9IGNsb3Nlc3REb21haW4ucmVwbGFjZShuZXcgUmVnRXhwKGVtYWlsUGFydHMudG9wTGV2ZWxEb21haW4gKyBcIiRcIiksIGNsb3Nlc3RUb3BMZXZlbERvbWFpbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJ0cm4gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJ0cm4pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgYWRkcmVzczogZW1haWxQYXJ0cy5hZGRyZXNzLCBkb21haW46IGNsb3Nlc3REb21haW4sIGZ1bGw6IGVtYWlsUGFydHMuYWRkcmVzcyArIFwiQFwiICsgY2xvc2VzdERvbWFpbiB9O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvKiBUaGUgZW1haWwgYWRkcmVzcyBleGFjdGx5IG1hdGNoZXMgb25lIG9mIHRoZSBzdXBwbGllZCBkb21haW5zLCBkb2VzIG5vdCBjbG9zZWx5XHJcbiAgICAgICAgICAgICAgICAgKiBtYXRjaCBhbnkgZG9tYWluIGFuZCBkb2VzIG5vdCBhcHBlYXIgdG8gc2ltcGx5IGhhdmUgYSBtaXNwZWxsZWQgdG9wLWxldmVsIGRvbWFpbixcclxuICAgICAgICAgICAgICAgICAqIG9yIGlzIGFuIGludmFsaWQgZW1haWwgYWRkcmVzczsgZG8gbm90IHJldHVybiBhIHN1Z2dlc3Rpb24uXHJcbiAgICAgICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgIGZpbmRDbG9zZXN0RG9tYWluOiBmdW5jdGlvbiAoZG9tYWluLCBkb21haW5zLCBkaXN0YW5jZUZ1bmN0aW9uLCB0aHJlc2hvbGQpIHtcclxuICAgICAgICAgICAgICAgIHRocmVzaG9sZCA9IHRocmVzaG9sZCB8fCB0aGlzLnRvcExldmVsVGhyZXNob2xkO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRpc3Q7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWluRGlzdCA9IEluZmluaXR5O1xyXG4gICAgICAgICAgICAgICAgdmFyIGNsb3Nlc3REb21haW4gPSBudWxsO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghZG9tYWluIHx8ICFkb21haW5zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCFkaXN0YW5jZUZ1bmN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2VGdW5jdGlvbiA9IHRoaXMuc2lmdDREaXN0YW5jZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRvbWFpbnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZG9tYWluID09PSBkb21haW5zW2ldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkb21haW47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGRpc3QgPSBkaXN0YW5jZUZ1bmN0aW9uKGRvbWFpbiwgZG9tYWluc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3QgPCBtaW5EaXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pbkRpc3QgPSBkaXN0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbG9zZXN0RG9tYWluID0gZG9tYWluc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG1pbkRpc3QgPD0gdGhyZXNob2xkICYmIGNsb3Nlc3REb21haW4gIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2xvc2VzdERvbWFpbjtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG5cclxuICAgICAgICAgICAgc2lmdDREaXN0YW5jZTogZnVuY3Rpb24gKHMxLCBzMiwgbWF4T2Zmc2V0KSB7XHJcbiAgICAgICAgICAgICAgICAvLyBzaWZ0NDogaHR0cHM6Ly9zaWRlcml0ZS5ibG9nc3BvdC5jb20vMjAxNC8xMS9zdXBlci1mYXN0LWFuZC1hY2N1cmF0ZS1zdHJpbmctZGlzdGFuY2UuaHRtbFxyXG4gICAgICAgICAgICAgICAgaWYgKG1heE9mZnNldCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWF4T2Zmc2V0ID0gNTsgLy9kZWZhdWx0XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFzMSB8fCAhczEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHMyLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXMyIHx8ICFzMi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gczEubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBsMSA9IHMxLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIHZhciBsMiA9IHMyLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgYzEgPSAwOyAgLy9jdXJzb3IgZm9yIHN0cmluZyAxXHJcbiAgICAgICAgICAgICAgICB2YXIgYzIgPSAwOyAgLy9jdXJzb3IgZm9yIHN0cmluZyAyXHJcbiAgICAgICAgICAgICAgICB2YXIgbGNzcyA9IDA7ICAvL2xhcmdlc3QgY29tbW9uIHN1YnNlcXVlbmNlXHJcbiAgICAgICAgICAgICAgICB2YXIgbG9jYWxfY3MgPSAwOyAvL2xvY2FsIGNvbW1vbiBzdWJzdHJpbmdcclxuICAgICAgICAgICAgICAgIHZhciB0cmFucyA9IDA7ICAvL251bWJlciBvZiB0cmFuc3Bvc2l0aW9ucyAoJ2FiJyB2cyAnYmEnKVxyXG4gICAgICAgICAgICAgICAgdmFyIG9mZnNldF9hcnIgPSBbXTsgIC8vb2Zmc2V0IHBhaXIgYXJyYXksIGZvciBjb21wdXRpbmcgdGhlIHRyYW5zcG9zaXRpb25zXHJcblxyXG4gICAgICAgICAgICAgICAgd2hpbGUgKChjMSA8IGwxKSAmJiAoYzIgPCBsMikpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoczEuY2hhckF0KGMxKSA9PSBzMi5jaGFyQXQoYzIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsX2NzKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpc1RyYW5zID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vc2VlIGlmIGN1cnJlbnQgbWF0Y2ggaXMgYSB0cmFuc3Bvc2l0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGkgPCBvZmZzZXRfYXJyLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9mcyA9IG9mZnNldF9hcnJbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYzEgPD0gb2ZzLmMxIHx8IGMyIDw9IG9mcy5jMikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdoZW4gdHdvIG1hdGNoZXMgY3Jvc3MsIHRoZSBvbmUgY29uc2lkZXJlZCBhIHRyYW5zcG9zaXRpb24gaXMgdGhlIG9uZSB3aXRoIHRoZSBsYXJnZXN0IGRpZmZlcmVuY2UgaW4gb2Zmc2V0c1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVHJhbnMgPSBNYXRoLmFicyhjMiAtIGMxKSA+PSBNYXRoLmFicyhvZnMuYzIgLSBvZnMuYzEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc1RyYW5zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFvZnMudHJhbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mcy50cmFucyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFucysrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYzEgPiBvZnMuYzIgJiYgYzIgPiBvZnMuYzEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0X2Fyci5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXRfYXJyLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYzE6IGMxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYzI6IGMyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnM6IGlzVHJhbnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGNzcyArPSBsb2NhbF9jcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfY3MgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYzEgIT0gYzIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMxID0gYzIgPSBNYXRoLm1pbihjMSwgYzIpOyAgLy91c2luZyBtaW4gYWxsb3dzIHRoZSBjb21wdXRhdGlvbiBvZiB0cmFuc3Bvc2l0aW9uc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgbWF0Y2hpbmcgY2hhcmFjdGVycyBhcmUgZm91bmQsIHJlbW92ZSAxIGZyb20gYm90aCBjdXJzb3JzICh0aGV5IGdldCBpbmNyZW1lbnRlZCBhdCB0aGUgZW5kIG9mIHRoZSBsb29wKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3NvIHRoYXQgd2UgY2FuIGhhdmUgb25seSBvbmUgY29kZSBibG9jayBoYW5kbGluZyBtYXRjaGVzIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1heE9mZnNldCAmJiAoYzEgKyBqIDwgbDEgfHwgYzIgKyBqIDwgbDIpOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoYzEgKyBqIDwgbDEpICYmIChzMS5jaGFyQXQoYzEgKyBqKSA9PSBzMi5jaGFyQXQoYzIpKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMxICs9IGogLSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMyLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGMyICsgaiA8IGwyKSAmJiAoczEuY2hhckF0KGMxKSA9PSBzMi5jaGFyQXQoYzIgKyBqKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjMS0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGMyICs9IGogLSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGMxKys7XHJcbiAgICAgICAgICAgICAgICAgICAgYzIrKztcclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGNvdmVycyB0aGUgY2FzZSB3aGVyZSB0aGUgbGFzdCBtYXRjaCBpcyBvbiB0aGUgbGFzdCB0b2tlbiBpbiBsaXN0LCBzbyB0aGF0IGl0IGNhbiBjb21wdXRlIHRyYW5zcG9zaXRpb25zIGNvcnJlY3RseVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICgoYzEgPj0gbDEpIHx8IChjMiA+PSBsMikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGNzcyArPSBsb2NhbF9jcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfY3MgPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjMSA9IGMyID0gTWF0aC5taW4oYzEsIGMyKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBsY3NzICs9IGxvY2FsX2NzO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoTWF0aC5tYXgobDEsIGwyKSAtIGxjc3MgKyB0cmFucyk7IC8vYWRkIHRoZSBjb3N0IG9mIHRyYW5zcG9zaXRpb25zIHRvIHRoZSBmaW5hbCByZXN1bHRcclxuICAgICAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgIHNwbGl0RW1haWw6IGZ1bmN0aW9uIChlbWFpbCkge1xyXG4gICAgICAgICAgICAgICAgZW1haWwgPSBlbWFpbCAhPT0gbnVsbCA/IChlbWFpbC5yZXBsYWNlKC9eXFxzKi8sICcnKS5yZXBsYWNlKC9cXHMqJC8sICcnKSkgOiBudWxsOyAvLyB0cmltKCkgbm90IGV4aXN0IGluIG9sZCBJRSFcclxuICAgICAgICAgICAgICAgIHZhciBwYXJ0cyA9IGVtYWlsLnNwbGl0KCdAJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA8IDIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXJ0cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0c1tpXSA9PT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgZG9tYWluID0gcGFydHMucG9wKCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZG9tYWluUGFydHMgPSBkb21haW4uc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgICAgIHZhciBzbGQgPSAnJztcclxuICAgICAgICAgICAgICAgIHZhciB0bGQgPSAnJztcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZG9tYWluUGFydHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGFkZHJlc3MgZG9lcyBub3QgaGF2ZSBhIHRvcC1sZXZlbCBkb21haW5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRvbWFpblBhcnRzLmxlbmd0aCA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGFkZHJlc3MgaGFzIG9ubHkgYSB0b3AtbGV2ZWwgZG9tYWluICh2YWxpZCB1bmRlciBSRkMpXHJcbiAgICAgICAgICAgICAgICAgICAgdGxkID0gZG9tYWluUGFydHNbMF07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIFRoZSBhZGRyZXNzIGhhcyBhIGRvbWFpbiBhbmQgYSB0b3AtbGV2ZWwgZG9tYWluXHJcbiAgICAgICAgICAgICAgICAgICAgc2xkID0gZG9tYWluUGFydHNbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDE7IGogPCBkb21haW5QYXJ0cy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0bGQgKz0gZG9tYWluUGFydHNbal0gKyAnLic7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRsZCA9IHRsZC5zdWJzdHJpbmcoMCwgdGxkLmxlbmd0aCAtIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdG9wTGV2ZWxEb21haW46IHRsZCxcclxuICAgICAgICAgICAgICAgICAgICBzZWNvbmRMZXZlbERvbWFpbjogc2xkLFxyXG4gICAgICAgICAgICAgICAgICAgIGRvbWFpbjogZG9tYWluLFxyXG4gICAgICAgICAgICAgICAgICAgIGFkZHJlc3M6IHBhcnRzLmpvaW4oJ0AnKVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSxcclxuXHJcbiAgICAgICAgICAgIC8vIEVuY29kZSB0aGUgZW1haWwgYWRkcmVzcyB0byBwcmV2ZW50IFhTUyBidXQgbGVhdmUgaW4gdmFsaWRcclxuICAgICAgICAgICAgLy8gY2hhcmFjdGVycywgZm9sbG93aW5nIHRoaXMgb2ZmaWNpYWwgc3BlYzpcclxuICAgICAgICAgICAgLy8gaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9FbWFpbF9hZGRyZXNzI1N5bnRheFxyXG4gICAgICAgICAgICBlbmNvZGVFbWFpbDogZnVuY3Rpb24gKGVtYWlsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gZW5jb2RlVVJJKGVtYWlsKTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKCclMjAnLCAnICcpLnJlcGxhY2UoJyUyNScsICclJykucmVwbGFjZSgnJTVFJywgJ14nKVxyXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCclNjAnLCAnYCcpLnJlcGxhY2UoJyU3QicsICd7JykucmVwbGFjZSgnJTdDJywgJ3wnKVxyXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCclN0QnLCAnfScpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIE1haWxjaGVjaztcclxuICAgIH1cclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnbmdNYWlsY2hlY2snKVxyXG4gICAgICAgIC5mYWN0b3J5KCdtYWlsY2hlY2tGYWN0b3J5JywgbWFpbGNoZWNrRmFjdG9yeSk7XHJcblxyXG59ICgpKTsiXX0=
